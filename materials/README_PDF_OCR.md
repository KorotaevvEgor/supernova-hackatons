# –°–∏—Å—Ç–µ–º–∞ OCR –¥–ª—è –¢–¢–ù —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π PDF

## –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ ‚ú®

- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ PDF —Ñ–∞–π–ª–æ–≤** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –¢–¢–ù –∏–∑ PDF –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–¥–æ 5 —Å—Ç—Ä–∞–Ω–∏—Ü)
- **–¢–∞–±–ª–∏—á–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç** - —ç–∫—Å–ø–æ—Ä—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ CSV –∏ Excel —Ñ–æ—Ä–º–∞—Ç—ã
- **–ú–∞—Å—Å–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –ø–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–æ—Ç—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- **–£–ª—É—á—à–µ–Ω–Ω—ã–π API** - –Ω–æ–≤—ã–µ endpoints –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç üöÄ

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PDF –±–∏–±–ª–∏–æ—Ç–µ–∫
pip install PyMuPDF==1.23.30 pdf2image==1.17.0

# –î–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ Excel (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã)
pip install pandas==2.3.2 openpyxl==3.1.5
```

### 2. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
cd /path/to/your/project
python manage.py migrate materials
```

### 3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ PDF –¥–æ–∫—É–º–µ–Ω—Ç

```python
import requests

# –ó–∞–≥—Ä—É–∑–∫–∞ PDF —Ñ–∞–π–ª–∞
with open('document.pdf', 'rb') as f:
    response = requests.post(
        'http://localhost:8000/api/materials/ttn/upload/',
        files={'image': f},
        data={'delivery_id': 123},
        headers={'Authorization': 'Bearer YOUR_TOKEN'}
    )

print(response.json())
```

### 4. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ

```bash
# –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:8000/api/materials/ttn/export/csv/"

# –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel —Å–æ —Å–≤–æ–¥–∫–æ–π
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:8000/api/materials/ttn/export/summary/" \
  -o ttn_summary.xlsx
```

## –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ üìù

### –§–∞–π–ª—ã

- `ocr_service.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ PDF (–º–µ—Ç–æ–¥—ã `_extract_text_from_pdf`, `_preprocess_image_from_pil`)
- `export_utils.py` - –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
- `ocr_api_views.py` - –Ω–æ–≤—ã–µ API –∫–ª–∞—Å—Å—ã `ExportTTNDataAPIView`, `BulkProcessDocumentsAPIView`
- `models.py` - –º–æ–¥–µ–ª—å `DocumentPhoto` —Ä–∞—Å—à–∏—Ä–µ–Ω–∞ –ø–æ–ª—è–º–∏ `file_type`, `pages_count`
- `requirements.txt` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ PyMuPDF –∏ pdf2image
- `api_urls.py` - –Ω–æ–≤—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –∏ –º–∞—Å—Å–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

### API endpoints

- `POST /api/materials/ttn/upload/` - —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç PDF —Ñ–∞–π–ª—ã
- `GET /api/materials/ttn/export/{format_type}/` - —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö (csv, excel, summary)
- `POST /api/materials/ttn/bulk-process/` - –º–∞—Å—Å–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### –§—É–Ω–∫—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞

- **CSV —ç–∫—Å–ø–æ—Ä—Ç** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–∏—Ä–∏–ª–ª–∏—Ü—ã
- **Excel —ç–∫—Å–ø–æ—Ä—Ç** - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π —à–∏—Ä–∏–Ω—ã –∫–æ–ª–æ–Ω–æ–∫
- **–°–≤–æ–¥–Ω—ã–µ –æ—Ç—á–µ—Ç—ã** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¢–¢–ù —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ üí°

### –ó–∞–≥—Ä—É–∑–∫–∞ PDF —Ñ–∞–π–ª–∞

```javascript
const formData = new FormData();
formData.append('image', pdfFile); // PDF —Ñ–∞–π–ª
formData.append('delivery_id', deliveryId);

fetch('/api/materials/ttn/upload/', {
    method: 'POST',
    headers: {
        'Authorization': 'Bearer ' + token
    },
    body: formData
})
.then(response => response.json())
.then(data => {
    if (data.success) {
        console.log('PDF –æ–±—Ä–∞–±–æ—Ç–∞–Ω:', data.data.ocr_result);
        console.log('–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:', data.data.ocr_result.confidence + '%');
    }
});
```

### –ú–∞—Å—Å–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

```python
# –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –Ω–µ–æ—Ç—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞
response = requests.post(
    'http://localhost:8000/api/materials/ttn/bulk-process/',
    json={'project_id': 123, 'max_documents': 50},
    headers={'Authorization': 'Bearer YOUR_TOKEN'}
)

result = response.json()
print(f"–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: {result['data']['processed_count']}")
print(f"–û—à–∏–±–æ–∫: {result['data']['failed_count']}")
```

### –≠–∫—Å–ø–æ—Ä—Ç —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏

```python
# –≠–∫—Å–ø–æ—Ä—Ç —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –¥–∞—Ç–µ
params = {
    'project_id': 123,
    'date_from': '2024-01-01',
    'date_to': '2024-12-31',
    'include_ocr_details': True
}

response = requests.get(
    'http://localhost:8000/api/materials/ttn/export/excel/',
    params=params,
    headers={'Authorization': 'Bearer YOUR_TOKEN'}
)

with open('filtered_export.xlsx', 'wb') as f:
    f.write(response.content)
```

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ PDF –æ–±—Ä–∞–±–æ—Ç–∫–∏ üìÑ

### –ß—Ç–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è:
- PDF —Ñ–∞–π–ª—ã –¥–æ 5 —Å—Ç—Ä–∞–Ω–∏—Ü
- –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏: 200 DPI
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ä—É—Å—Å–∫–∏–π –∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —Ç–µ–∫—Å—Ç
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- –ú–∞–∫—Å–∏–º—É–º 5 —Å—Ç—Ä–∞–Ω–∏—Ü –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç
- PDF –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—É—é –∏–ª–∏ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –ø–∞—Ä–æ–ª–µ–º PDF –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞—á–µ—Å—Ç–≤–∞ üìä

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è:

- **–í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ (>80%)** ‚úÖ - –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–Ω—è—Ç—ã
- **–°—Ä–µ–¥–Ω–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ (60-80%)** ‚ö†Ô∏è - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞
- **–ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ (<60%)** ‚ùå - —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö üìã

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è –¢–¢–ù:
- –ù–æ–º–µ—Ä –∏ –¥–∞—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
- –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—å (—Å –ò–ù–ù)
- –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–Ω–æ–º–µ—Ä –¢–°, –≤–æ–¥–∏—Ç–µ–ª—å)
- –î–∞–Ω–Ω—ã–µ –æ –≥—Ä—É–∑–µ (–æ–ø–∏—Å–∞–Ω–∏–µ, –≤–µ—Å, –æ–±—ä–µ–º)
- –°—Ç–∞—Ç—É—Å—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å OCR

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–ø—Ä–∏ `include_ocr_details=true`):
- –î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã OCR
- –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –∫–∞–∂–¥–æ–º—É –ø–æ–ª—é
- –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º üîß

### PDF –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ PyMuPDF –∏ pdf2image
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–Ω–µ –±–æ–ª–µ–µ 10 –ú–ë)
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PDF –Ω–µ –∑–∞—â–∏—â–µ–Ω –ø–∞—Ä–æ–ª–µ–º

### –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ PDF —Å –≤—ã—Å–æ–∫–∏–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–µ–∫—Å—Ç –Ω–µ —Ä–∞–∑–º—ã—Ç
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (–ø—Ä—è–º–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)

### –û—à–∏–±–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
3. –î–ª—è Excel —ç–∫—Å–ø–æ—Ä—Ç–∞ –Ω—É–∂–Ω—ã pandas –∏ openpyxl

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞ üí¨

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–º–æ—â–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫:
- [API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](./API_DOCUMENTATION.md) - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ API
- –õ–æ–≥–∞–º Django - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- –ü–∞–Ω–µ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ OCR —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤