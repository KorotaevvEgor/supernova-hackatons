<!DOCTYPE html>
<html lang="ru" class="h-full bg-gray-50">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º –ú–æ—Å–∫–≤—ã">
    <title>–ì–ª–∞–≤–Ω–∞—è - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-dark': '#151E3F',
                        'primary-blue': '#2942F9', 
                        'secondary-blue': '#384358',
                        'accent-peach': '#FFA586',
                        'accent-red': '#A51A2B',
                        'accent-burgundy': '#53143F',
                        'gradient-start': '#A51A2B',
                        'gradient-end': '#53143F',
                    }
                }
            }
        }
    </script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- OpenLayers –∏ —Ä–æ—Å—Å–∏–π—Å–∫–∞—è –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v9.0.0/ol.css" type="text/css">
    <script src="https://cdn.jsdelivr.net/npm/ol@v9.0.0/dist/ol.js"></script>
    <script src="/static/js/russian-map.js"></script>
    
    <!-- Chart.js –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- –§—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ - –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–Ω–æ -->
    <script>
        function selectProject(projectId) {
            console.log('selectProject called with:', projectId);
            
            if (projectId === 'all') {
                // –ü–µ—Ä–µ—Ö–æ–¥ –∫ –æ–±—â–µ–º—É –æ–±–∑–æ—Ä—É
                console.log('Redirecting to home page');
                window.location.href = '/';
            } else {
                // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
                const targetUrl = `/projects/${projectId}/`;
                console.log('Redirecting to project page:', targetUrl);
                window.location.href = targetUrl;
            }
        }
        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–æ–π
        window.selectProject = selectProject;
    </script>
    
    <!-- Custom CSS -->
    <style>
        .map-container { 
            min-height: 450px; 
            border-radius: 12px;
            overflow: hidden;
        }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .weather-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            color: white;
        }
        .ol-popup {
            border-radius: 12px !important;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15) !important;
        }
    </style>
</head>

<body class="h-full">
    <div class="flex h-screen bg-gray-50">
        <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
        <div class="flex flex-col w-64 bg-gradient-to-b from-primary-dark via-secondary-blue to-accent-burgundy">
            <!-- –õ–æ–≥–æ—Ç–∏–ø -->
            <div class="flex items-center justify-center h-16 px-4 bg-primary-dark/90 backdrop-blur-sm">
                <div class="flex items-center">
                    <i class="fas fa-city text-accent-peach text-2xl mr-3"></i>
                    <span class="text-white font-bold text-sm">–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è<br/>–±–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º</span>
                </div>
            </div>
            
            <!-- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
            {% if user and user.is_authenticated %}
            <div class="px-4 py-4 bg-black/20 backdrop-blur-sm border-b border-white/10">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="h-10 w-10 rounded-full bg-gradient-to-r from-accent-peach to-primary-blue flex items-center justify-center">
                            <i class="fas fa-user text-white"></i>
                        </div>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm font-medium text-white">
                            {{ user.get_full_name|default:user.username }}
                        </p>
                        {% if user.user_type %}
                            <p class="text-xs text-accent-peach">
                                {{ user.get_user_type_display }}
                            </p>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- –°–µ–ª–µ–∫—Ç–æ—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤ -->
            <div class="px-2 py-4 border-b border-white/10">
                <label class="block text-xs font-medium text-accent-peach mb-2 uppercase tracking-wide">
                    –í—ã–±–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞
                </label>
                <div class="relative">
                    <select id="project-selector" onchange="console.log('onchange triggered with:', this.value); selectProject(this.value);" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:ring-2 focus:ring-accent-peach/50 backdrop-blur-sm appearance-none cursor-pointer">
                        <option value="all" class="bg-primary-dark text-white">–í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã</option>
                        {% for project in all_projects %}
                            <option value="{{ project.id }}" class="bg-primary-dark text-white" {% if selected_project and selected_project.id == project.id %}selected{% endif %}>
                                {{ project.name|truncatechars:40 }}
                            </option>
                        {% endfor %}
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                        <i class="fas fa-chevron-down text-accent-peach text-xs"></i>
                    </div>
                </div>
                {% if selected_project %}
                    <div class="mt-3 p-3 bg-white/5 rounded-lg border border-white/10">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs font-medium text-accent-peach uppercase tracking-wide">–¢–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç</span>
                            <span class="px-2 py-1 text-xs rounded-full {% if selected_project.status == 'active' %}bg-primary-blue/20 text-primary-blue{% elif selected_project.status == 'completed' %}bg-accent-peach/20 text-accent-peach{% elif selected_project.status == 'suspended' %}bg-accent-red/20 text-accent-red{% else %}bg-secondary-blue/20 text-secondary-blue{% endif %}">
                                {{ selected_project.get_status_display }}
                            </span>
                        </div>
                        <p class="text-white text-sm font-medium mb-1">{{ selected_project.name }}</p>
                        <p class="text-white/60 text-xs mb-2">{{ selected_project.address|default:'–ê–¥—Ä–µ—Å –Ω–µ —É–∫–∞–∑–∞–Ω' }}</p>
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-white/60">–ü—Ä–æ–≥—Ä–µ—Å—Å:</span>
                            <span class="text-xs font-medium text-white">{{ selected_project.completion_percentage }}%</span>
                        </div>
                        <div class="w-full bg-white/20 rounded-full h-1.5 mt-1">
                            <div class="bg-gradient-to-r from-primary-blue to-accent-peach h-1.5 rounded-full transition-all duration-500" style="width: {{ selected_project.completion_percentage }}%"></div>
                        </div>
                        <a href="/projects/{{ selected_project.id }}/" class="mt-2 inline-flex items-center text-xs text-accent-peach hover:text-white transition-colors">
                            <i class="fas fa-external-link-alt mr-1"></i>
                            –ü–æ–¥—Ä–æ–±–Ω–æ –æ –ø—Ä–æ–µ–∫—Ç–µ
                        </a>
                    </div>
                {% endif %}
            </div>
            
            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–æ–µ –º–µ–Ω—é -->
            <nav class="flex-1 px-2 py-4 space-y-1">
                <a href="/" class="group flex items-center px-2 py-2 text-sm font-medium rounded-md text-white hover:bg-white/10 transition-all duration-200">
                    <i class="fas fa-home text-accent-peach mr-3 flex-shrink-0"></i>
                    –ì–ª–∞–≤–Ω–∞—è
                </a>
                <a href="/projects/" class="group flex items-center px-2 py-2 text-sm font-medium rounded-md text-white hover:bg-white/10 transition-all duration-200">
                    <i class="fas fa-project-diagram text-primary-blue mr-3 flex-shrink-0"></i>
                    –ü—Ä–æ–µ–∫—Ç—ã
                </a>
                <a href="/materials/" class="group flex items-center px-2 py-2 text-sm font-medium rounded-md text-white hover:bg-white/10 transition-all duration-200">
                    <i class="fas fa-boxes text-accent-peach mr-3 flex-shrink-0"></i>
                    –ú–∞—Ç–µ—Ä–∏–∞–ª—ã
                </a>
                <a href="/violations/" class="group flex items-center px-2 py-2 text-sm font-medium rounded-md text-white hover:bg-white/10 transition-all duration-200">
                    <i class="fas fa-exclamation-triangle text-accent-red mr-3 flex-shrink-0"></i>
                    –ù–∞—Ä—É—à–µ–Ω–∏—è
                </a>
                <a href="/analytics/" class="group flex items-center px-2 py-2 text-sm font-medium rounded-md text-white hover:bg-white/10 transition-all duration-200">
                    <i class="fas fa-chart-bar text-primary-blue mr-3 flex-shrink-0"></i>
                    –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
                </a>
                
                <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å -->
                <div class="border-t border-white/10 my-4"></div>
                
                <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É–Ω–∫—Ç—ã -->
                <a href="/api/projects/" class="group flex items-center px-2 py-2 text-sm font-medium rounded-md text-white/70 hover:bg-white/10 hover:text-white transition-all duration-200">
                    <i class="fas fa-code text-accent-peach/70 mr-3 flex-shrink-0"></i>
                    API
                </a>
            </nav>
            
            <!-- –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ -->
            {% if user and user.is_authenticated %}
            <div class="px-2 pb-4">
                <a href="/logout/" class="group flex items-center w-full px-2 py-2 text-sm font-medium rounded-md text-white bg-gradient-to-r from-accent-red to-accent-burgundy hover:from-accent-red/80 hover:to-accent-burgundy/80 transition-all duration-200">
                    <i class="fas fa-sign-out-alt text-white mr-3 flex-shrink-0"></i>
                    –í—ã–π—Ç–∏
                </a>
            </div>
            {% endif %}
        </div>

        <!-- –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="flex-1 overflow-y-auto bg-gray-50">
            <div class="py-6">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="mb-8">
                        <div class="flex items-center justify-between">
                            <div>
                                <h1 class="text-2xl font-semibold text-gray-900">–ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å</h1>
                                <p class="mt-1 text-sm text-gray-600">
                                    {% if selected_project %}
                                        –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –ø—Ä–æ–µ–∫—Ç—É: <span class="font-medium text-primary-blue">{{ selected_project.name }}</span>
                                    {% else %}
                                        –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º –ú–æ—Å–∫–≤—ã
                                    {% endif %}
                                </p>
                            </div>
                            {% if selected_project %}
                                <div class="flex space-x-2">
                                    <div class="inline-flex items-center px-3 py-2 border border-blue-200 bg-blue-50 text-blue-800 text-sm rounded-lg">
                                        <i class="fas fa-info-circle mr-2"></i>
                                        –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
                                    </div>
                                    <a href="?" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors">
                                        <i class="fas fa-times mr-2"></i>
                                        –û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä
                                    </a>
                                </div>
                            {% endif %}
                        </div>
                    </div>
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                    <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4 mb-8">
                        <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã -->
                        <div class="card-hover bg-white overflow-hidden shadow-lg rounded-xl border-l-4 border-primary-blue">
                            <div class="p-5">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <div class="h-12 w-12 bg-gradient-to-r from-primary-blue to-accent-peach rounded-lg flex items-center justify-center">
                                            <i class="fas fa-project-diagram text-white text-lg"></i>
                                        </div>
                                    </div>
                                    <div class="ml-5 w-0 flex-1">
                                        <dl>
                                            <dt class="text-sm font-medium text-gray-500 truncate">
                                                {% if selected_project %}–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞{% else %}–ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã{% endif %}
                                            </dt>
                                            <dd class="text-2xl font-bold text-gray-900">
                                                {% if selected_project %}
                                                    {{ selected_project.get_status_display }}
                                                {% else %}
                                                    {{ stats.active_projects }}
                                                {% endif %}
                                            </dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gradient-to-r from-primary-blue/10 to-accent-peach/10 px-5 py-3">
                                <div class="text-sm">
                                    {% if selected_project %}
                                        <span class="text-primary-blue font-medium">–ü—Ä–æ–≥—Ä–µ—Å—Å: {{ selected_project.completion_percentage }}%</span>
                                    {% else %}
                                        <span class="text-primary-blue font-medium">{{ stats.total_projects }} –≤—Å–µ–≥–æ</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- –ü–æ—Å—Ç–∞–≤–∫–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ -->
                        <div class="card-hover bg-white overflow-hidden shadow-lg rounded-xl border-l-4 border-accent-peach">
                            <div class="p-5">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <div class="h-12 w-12 bg-gradient-to-r from-accent-peach to-primary-blue rounded-lg flex items-center justify-center">
                                            <i class="fas fa-truck text-white text-lg"></i>
                                        </div>
                                    </div>
                                    <div class="ml-5 w-0 flex-1">
                                        <dl>
                                            <dt class="text-sm font-medium text-gray-500 truncate">–ü–æ—Å—Ç–∞–≤–∫–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</dt>
                                            <dd class="text-2xl font-bold text-gray-900">{{ stats.materials_delivered }}</dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gradient-to-r from-accent-peach/10 to-primary-blue/10 px-5 py-3">
                                <div class="text-sm">
                                    <span class="text-accent-peach font-medium">{{ stats.materials_today }} —Å–µ–≥–æ–¥–Ω—è</span>
                                </div>
                            </div>
                        </div>

                        <!-- –ù–∞—Ä—É—à–µ–Ω–∏—è -->
                        <div class="card-hover bg-white overflow-hidden shadow-lg rounded-xl border-l-4 border-accent-red">
                            <div class="p-5">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <div class="h-12 w-12 bg-gradient-to-r from-accent-red to-accent-burgundy rounded-lg flex items-center justify-center">
                                            <i class="fas fa-exclamation-triangle text-white text-lg"></i>
                                        </div>
                                    </div>
                                    <div class="ml-5 w-0 flex-1">
                                        <dl>
                                            <dt class="text-sm font-medium text-gray-500 truncate">–ê–∫—Ç–∏–≤–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è</dt>
                                            <dd class="text-2xl font-bold text-gray-900">{{ stats.active_violations }}</dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gradient-to-r from-accent-red/10 to-accent-burgundy/10 px-5 py-3">
                                <div class="text-sm">
                                    <span class="text-accent-red font-medium">{{ stats.overdue_violations }} –ø—Ä–æ—Å—Ä–æ—á–µ–Ω—ã</span>
                                </div>
                            </div>
                        </div>

                        <!-- –û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å -->
                        <div class="card-hover bg-white overflow-hidden shadow-lg rounded-xl border-l-4 border-secondary-blue">
                            <div class="p-5">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <div class="h-12 w-12 bg-gradient-to-r from-secondary-blue to-accent-burgundy rounded-lg flex items-center justify-center">
                                            <i class="fas fa-chart-pie text-white text-lg"></i>
                                        </div>
                                    </div>
                                    <div class="ml-5 w-0 flex-1">
                                        <dl>
                                            <dt class="text-sm font-medium text-gray-500 truncate">–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å</dt>
                                            <dd class="text-2xl font-bold text-gray-900">{{ stats.overall_progress }}%</dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gradient-to-r from-secondary-blue/10 to-accent-burgundy/10 px-5 py-3">
                                <div class="w-full bg-gray-200 rounded-full h-3">
                                    <div class="bg-gradient-to-r from-secondary-blue to-accent-burgundy h-3 rounded-full transition-all duration-500" style="width: {{ stats.overall_progress }}%"></div>
                                </div>
                            </div>
                        </div>
                </div>
            </div>

                <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
                    <div class="px-4 lg:px-8">
                        <!-- –°–µ—Ç–µ–≤–æ–π –≥—Ä–∞—Ñ–∏–∫ (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞) -->
                        {% if selected_project and work_schedule %}
                        <div class="bg-white shadow-xl rounded-2xl border border-gray-100 overflow-hidden mb-6">
                            <div class="px-6 py-4 bg-gradient-to-r from-indigo-50 to-purple-50 border-b border-gray-100">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <div class="h-10 w-10 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-lg flex items-center justify-center mr-3">
                                            <i class="fas fa-project-diagram text-white text-sm"></i>
                                        </div>
                                        <div>
                                            <h3 class="text-lg leading-6 font-semibold text-gray-900">
                                                –°–µ—Ç–µ–≤–æ–π –≥—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç
                                            </h3>
                                            <p class="text-sm text-gray-600">{{ selected_project.name }}</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-sm font-medium text-gray-900">–í—Å–µ–≥–æ —Ä–∞–±–æ—Ç: {{ work_schedule|length }}</div>
                                        <div class="text-xs text-gray-600">–ü—Ä–æ–≥—Ä–µ—Å—Å: {{ selected_project.completion_percentage }}%</div>
                                    </div>
                                </div>
                            </div>
                            <div class="px-6 py-4">
                                <!-- –ì—Ä–∞—Ñ–∏–∫ Gantt -->
                                <div id="gantt-chart" class="relative">
                                    <div class="overflow-x-auto">
                                        <div class="min-w-800" style="min-width: 800px;">
                                            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–π–º–ª–∞–π–Ω–∞ -->
                                            <div class="flex border-b border-gray-200 pb-2 mb-4">
                                                <div class="w-64 flex-shrink-0">
                                                    <h4 class="font-medium text-gray-900 text-sm">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç</h4>
                                                </div>
                                                <div class="flex-1 ml-4">
                                                    <div class="grid" id="timeline-header" style="grid-template-columns: repeat(30, 1fr); gap: 1px;">
                                                        <!-- –î–∞—Ç—ã –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã JavaScript -->
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- –°—Ç—Ä–æ–∫–∏ —Ä–∞–±–æ—Ç -->
                                            <div class="space-y-3">
                                                {% for work in work_schedule %}
                                                <div class="flex items-center border border-gray-200 rounded-lg p-3 hover:shadow-sm transition-shadow" data-work-id="{{ work.id }}">
                                                    <div class="w-64 flex-shrink-0">
                                                        <div class="flex items-center">
                                                            <div class="h-3 w-3 rounded-full mr-2 {% if work.status == 'completed' or work.status == 'verified' %}bg-green-500{% elif work.status == 'in_progress' %}bg-yellow-500{% elif work.is_delayed %}bg-red-500{% else %}bg-gray-400{% endif %}"></div>
                                                            <div>
                                                                <h5 class="font-medium text-gray-900 text-sm leading-tight">{{ work.work_type|truncatechars:25 }}</h5>
                                                                <p class="text-xs text-gray-500">{{ work.volume }} {{ work.unit }}</p>
                                                                {% if work.is_delayed %}
                                                                    <p class="text-xs text-red-600">‚úó –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</p>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="flex-1 ml-4 relative">
                                                        <div class="h-6 bg-gray-100 rounded relative">
                                                            <!-- –ü–æ–ª–æ—Å–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –±—É–¥–µ—Ç –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∞ JavaScript -->
                                                            <div class="gantt-bar absolute h-6 rounded flex items-center justify-center text-white text-xs font-medium transition-all duration-300
                                                                {% if work.status == 'completed' or work.status == 'verified' %}bg-green-500{% elif work.status == 'in_progress' %}bg-yellow-500{% elif work.is_delayed %}bg-red-500{% else %}bg-blue-500{% endif %}"
                                                                data-start="{{ work.planned_start|date:'Y-m-d' }}"
                                                                data-end="{{ work.planned_end|date:'Y-m-d' }}"
                                                                data-duration="{{ work.duration_days }}"
                                                                data-progress="{{ work.progress_percentage }}">
                                                                <span class="px-1">{{ work.progress_percentage }}%</span>
                                                            </div>
                                                        </div>
                                                        <div class="text-xs text-gray-600 mt-1">
                                                            {{ work.planned_start|date:'d.m' }} - {{ work.planned_end|date:'d.m' }} 
                                                            <span class="text-gray-500">({{ work.duration_days }} –¥–Ω.)</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- –õ–µ–≥–µ–Ω–¥–∞ -->
                                <div class="mt-4 pt-4 border-t border-gray-200">
                                    <div class="flex flex-wrap items-center gap-4 text-xs">
                                        <div class="flex items-center">
                                            <div class="h-3 w-3 bg-green-500 rounded-full mr-2"></div>
                                            <span class="text-gray-600">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                                        </div>
                                        <div class="flex items-center">
                                            <div class="h-3 w-3 bg-yellow-500 rounded-full mr-2"></div>
                                            <span class="text-gray-600">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</span>
                                        </div>
                                        <div class="flex items-center">
                                            <div class="h-3 w-3 bg-blue-500 rounded-full mr-2"></div>
                                            <span class="text-gray-600">–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ</span>
                                        </div>
                                        <div class="flex items-center">
                                            <div class="h-3 w-3 bg-red-500 rounded-full mr-2"></div>
                                            <span class="text-gray-600">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <!-- –ö–∞—Ä—Ç–∞ –æ–±—ä–µ–∫—Ç–æ–≤ -->
                            <div class="lg:col-span-2">
                                <div class="bg-white shadow-xl rounded-2xl border border-gray-100 overflow-hidden">
                                    <div class="px-6 py-4 bg-gradient-to-r from-primary-blue/5 to-accent-peach/5 border-b border-gray-100">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center">
                                                <div class="h-10 w-10 bg-gradient-to-r from-primary-blue to-accent-peach rounded-lg flex items-center justify-center mr-3">
                                                    <i class="fas fa-map-marked-alt text-white text-sm"></i>
                                                </div>
                                                <div>
                                                    <h3 class="text-lg leading-6 font-semibold text-gray-900">
                                                        {% if selected_project %}
                                                            –õ–æ–∫–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
                                                        {% else %}
                                                            –ö–∞—Ä—Ç–∞ –æ–±—ä–µ–∫—Ç–æ–≤ –±–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                                                        {% endif %}
                                                    </h3>
                                                    {% if selected_project %}
                                                        <p class="text-sm text-gray-600">{{ selected_project.address }}</p>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="flex space-x-2">
                                                <select id="map-provider" class="text-sm border border-gray-300 rounded px-3 py-1 bg-white">
                                                    <option value="osm" selected>üó∫Ô∏è –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞</option>
                                                    <option value="satellite">üõ∞Ô∏è –°–ø—É—Ç–Ω–∏–∫–æ–≤–∞—è</option>
                                                </select>
                                            </div>
                                            {% if selected_project %}
                                                <div class="flex items-center space-x-2">
                                                    <span class="px-3 py-1 text-xs rounded-full {% if selected_project.status == 'active' %}bg-primary-blue/10 text-primary-blue{% elif selected_project.status == 'completed' %}bg-accent-peach/10 text-accent-peach{% elif selected_project.status == 'suspended' %}bg-accent-red/10 text-accent-red{% else %}bg-secondary-blue/10 text-secondary-blue{% endif %}">
                                                        {{ selected_project.get_status_display }}
                                                    </span>
                                                    <span class="text-sm font-medium text-gray-700">{{ selected_project.completion_percentage }}%</span>
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="p-4 relative">
                                        <div id="map-loading" class="absolute inset-0 flex items-center justify-center bg-gray-50 rounded-lg z-10">
                                            <div class="text-center">
                                                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-blue mb-2"></div>
                                                <p class="text-sm text-gray-600">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã...</p>
                                            </div>
                                        </div>
                                        <div id="map" class="map-container"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
                            <div class="lg:col-span-1 space-y-6">
                                <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–≥–æ–¥—ã (–≤—Å–µ–≥–¥–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è) -->
                                <div id="weather-card" class="weather-card p-6 shadow-xl mb-6">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center">
                                            <div class="h-8 w-8 bg-white/20 rounded-lg flex items-center justify-center mr-3">
                                                <i class="fas fa-cloud-sun text-white text-sm"></i>
                                            </div>
                                            <h3 class="text-lg font-semibold text-white">–ü–æ–≥–æ–¥–∞</h3>
                                        </div>
                                        <div id="weather-loading" class="text-white/80 text-sm">
                                            <i class="fas fa-spinner fa-spin mr-1"></i> –ó–∞–≥—Ä—É–∑–∫–∞...
                                        </div>
                                    </div>
                                    <div id="weather-content" class="hidden">
                                        <div class="flex items-center justify-between mb-3">
                                            <div>
                                                <div class="text-2xl font-bold text-white" id="weather-temp">--¬∞</div>
                                                <div class="text-white/80 text-sm" id="weather-desc">--</div>
                                            </div>
                                            <div class="text-4xl" id="weather-icon">üå§Ô∏è</div>
                                        </div>
                                        <div class="space-y-2 text-sm">
                                            <div class="flex justify-between text-white/80">
                                                <span>–û—â—É—â–∞–µ—Ç—Å—è:</span>
                                                <span id="weather-feels">--¬∞</span>
                                            </div>
                                            <div class="flex justify-between text-white/80">
                                                <span>–í–ª–∞–∂–Ω–æ—Å—Ç—å:</span>
                                                <span id="weather-humidity">--%</span>
                                            </div>
                                            <div class="flex justify-between text-white/80">
                                                <span>–í–µ—Ç–µ—Ä:</span>
                                                <span id="weather-wind">-- –º/—Å</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="weather-error" class="hidden text-white/80 text-sm text-center py-4">
                                        <i class="fas fa-exclamation-triangle mr-1"></i> –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                                    </div>
                                </div>

                                <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
                                {% if selected_project %}
                                    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å–æ—Å—Ç–∞–≤–∞ —Ä–∞–±–æ—Ç -->
                                    {% if work_types_summary %}
                                    <div class="bg-white shadow-xl rounded-2xl border border-gray-100 overflow-hidden mb-6">
                                        <div class="px-6 py-4 bg-gradient-to-r from-green-50 to-blue-50 border-b border-gray-100">
                                            <div class="flex items-center">
                                                <div class="h-8 w-8 bg-gradient-to-r from-green-600 to-blue-600 rounded-lg flex items-center justify-center mr-3">
                                                    <i class="fas fa-tasks text-white text-sm"></i>
                                                </div>
                                                <h3 class="text-lg leading-6 font-semibold text-gray-900">
                                                    –°–æ—Å—Ç–∞–≤ —Ä–∞–±–æ—Ç
                                                </h3>
                                            </div>
                                        </div>
                                        <div class="px-6 py-4 max-h-80 overflow-y-auto">
                                            <div class="space-y-3">
                                                {% for work_type in work_types_summary %}
                                                <div class="border border-gray-200 rounded-lg p-3 hover:shadow-md transition-shadow">
                                                    <div class="flex items-center justify-between mb-2">
                                                        <div class="flex-1">
                                                            <h4 class="font-medium text-gray-900 text-sm">{{ work_type.name }}</h4>
                                                            <p class="text-xs text-gray-500">–ö–æ–¥: {{ work_type.code }}</p>
                                                        </div>
                                                        <div class="text-right">
                                                            <div class="text-xs text-gray-600">{{ work_type.completed_works }}/{{ work_type.total_works }}</div>
                                                        </div>
                                                    </div>
                                                    <div class="flex items-center">
                                                        <div class="flex-1 bg-gray-200 rounded-full h-2 mr-2">
                                                            <div class="h-2 rounded-full transition-all duration-300 {% if work_type.completion_rate >= 80 %}bg-green-500{% elif work_type.completion_rate >= 50 %}bg-yellow-500{% else %}bg-red-500{% endif %}" style="width: {{ work_type.completion_rate }}%"></div>
                                                        </div>
                                                        <span class="text-xs font-medium text-gray-700 min-w-10">{{ work_type.completion_rate }}%</span>
                                                    </div>
                                                </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                        <div class="px-6 py-3 bg-gray-50 border-t border-gray-100">
                                            <div class="text-xs text-gray-600 text-center">
                                                <i class="fas fa-info-circle mr-1"></i>
                                                –û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å: {{ selected_project.completion_percentage }}%
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                    
                                    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
                                    {% if work_specification %}
                                    <div class="bg-white shadow-xl rounded-2xl border border-gray-100 overflow-hidden">
                                        <div class="px-6 py-4 bg-gradient-to-r from-purple-50 to-pink-50 border-b border-gray-100">
                                            <div class="flex items-center">
                                                <div class="h-8 w-8 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg flex items-center justify-center mr-3">
                                                    <i class="fas fa-clipboard-list text-white text-sm"></i>
                                                </div>
                                                <h3 class="text-lg leading-6 font-semibold text-gray-900">
                                                    –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
                                                </h3>
                                            </div>
                                        </div>
                                        <div class="px-6 py-4 max-h-96 overflow-y-auto">
                                            <div class="space-y-2">
                                                {% for spec_row in work_specification %}
                                                <div class="border-l-4 border-blue-200 bg-blue-50 p-3 rounded-r-lg hover:shadow-sm transition-shadow">
                                                    <div class="flex justify-between items-start">
                                                        <div class="flex-1 mr-2">
                                                            <h5 class="font-medium text-gray-900 text-sm leading-tight">{{ spec_row.name|truncatechars:50 }}</h5>
                                                            {% if spec_row.code %}
                                                                <p class="text-xs text-gray-500 mt-1">–ö–æ–¥: {{ spec_row.code }}</p>
                                                            {% endif %}
                                                        </div>
                                                        <div class="text-right min-w-20">
                                                            {% if spec_row.planned_volume %}
                                                                <div class="text-sm font-medium text-gray-900">{{ spec_row.planned_volume|floatformat:2 }}</div>
                                                                <div class="text-xs text-gray-500">{{ spec_row.unit }}</div>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                        <div class="px-6 py-3 bg-gray-50 border-t border-gray-100">
                                            <div class="text-xs text-gray-600 text-center">
                                                <i class="fas fa-list-alt mr-1"></i>
                                                –ü–æ–∫–∞–∑–∞–Ω–æ –ø–µ—Ä–≤—ã—Ö {{ work_specification|length }} –ø–æ–∑–∏—Ü–∏–π
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                {% else %}
                                    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–∏—Å—Ç–µ–º–µ -->
                                    <div class="bg-white shadow-xl rounded-2xl border border-gray-100 overflow-hidden">
                                        <div class="px-6 py-4 bg-gradient-to-r from-primary-blue/5 to-accent-peach/5 border-b border-gray-100">
                                            <div class="flex items-center">
                                                <div class="h-8 w-8 bg-gradient-to-r from-primary-blue to-accent-peach rounded-lg flex items-center justify-center mr-3">
                                                    <i class="fas fa-city text-white text-sm"></i>
                                                </div>
                                                <h3 class="text-lg leading-6 font-semibold text-gray-900">
                                                    –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                                                </h3>
                                            </div>
                                        </div>
                                        <div class="px-6 py-6">
                                            <div class="text-center">
                                                <div class="h-12 w-12 mx-auto bg-gradient-to-r from-primary-blue/10 to-accent-peach/10 rounded-full flex items-center justify-center mb-4">
                                                    <i class="fas fa-chart-line text-primary-blue text-xl"></i>
                                                </div>
                                                <h4 class="text-lg font-semibold text-gray-900 mb-2">–û–±—â–∏–π –æ–±–∑–æ—Ä</h4>
                                                <p class="text-sm text-gray-600 mb-4">
                                                    –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
                                                </p>
                                                <div class="grid grid-cols-2 gap-4">
                                                    <div class="text-center p-3 bg-gray-50 rounded-lg">
                                                        <div class="text-xl font-bold text-primary-blue">{{ stats.total_projects }}</div>
                                                        <div class="text-xs text-gray-600">–ü—Ä–æ–µ–∫—Ç–æ–≤</div>
                                                    </div>
                                                    <div class="text-center p-3 bg-gray-50 rounded-lg">
                                                        <div class="text-xl font-bold text-accent-peach">{{ stats.active_projects }}</div>
                                                        <div class="text-xs text-gray-600">–ê–∫—Ç–∏–≤–Ω—ã–µ</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                                
                                <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
                                <div class="bg-white shadow-xl rounded-2xl border border-gray-100">
                                    <div class="px-6 py-4 bg-gradient-to-r from-accent-red/5 to-accent-burgundy/5 border-b border-gray-100">
                                        <div class="flex items-center">
                                            <div class="h-8 w-8 bg-gradient-to-r from-accent-red to-accent-burgundy rounded-lg flex items-center justify-center mr-3">
                                                <i class="fas fa-clock text-white text-sm"></i>
                                            </div>
                                            <h3 class="text-lg leading-6 font-semibold text-gray-900">
                                                {% if selected_project %}
                                                    –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ –ø—Ä–æ–µ–∫—Ç—É
                                                {% else %}
                                                    –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
                                                {% endif %}
                                            </h3>
                                        </div>
                                    </div>
                                    <div class="px-6 py-4">
                                        <div class="flow-root">
                                            <ul class="-mb-8 space-y-4 max-h-80 overflow-y-auto">
                                        {% for activity in recent_activities %}
                                        <li>
                                            <div class="relative pb-8">
                                                {% if not forloop.last %}
                                                <span class="absolute top-5 left-5 -ml-px h-full w-0.5 bg-gray-200"></span>
                                                {% endif %}
                                                <div class="relative flex items-start space-x-3">
                                                    <div class="relative">
                                                        {% if activity.type == 'material_delivery' %}
                                                            <div class="h-10 w-10 rounded-full bg-gradient-to-r from-accent-peach to-primary-blue flex items-center justify-center">
                                                                <i class="fas fa-truck text-white text-sm"></i>
                                                            </div>
                                                        {% elif activity.type == 'violation' %}
                                                            <div class="h-10 w-10 rounded-full bg-gradient-to-r from-accent-red to-accent-burgundy flex items-center justify-center">
                                                                <i class="fas fa-exclamation-triangle text-white text-sm"></i>
                                                            </div>
                                                        {% else %}
                                                            <div class="h-10 w-10 rounded-full bg-gradient-to-r from-primary-blue to-secondary-blue flex items-center justify-center">
                                                                <i class="fas fa-info text-white text-sm"></i>
                                                            </div>
                                                        {% endif %}
                                                    </div>
                                                    <div class="min-w-0 flex-1">
                                                        <div>
                                                            <div class="text-sm text-gray-500">
                                                                <time datetime="{{ activity.date|date:'c' }}">
                                                                    {{ activity.date|date:'d.m.Y H:i' }}
                                                                </time>
                                                            </div>
                                                            <p class="mt-0.5 text-sm font-medium text-gray-900">
                                                                {{ activity.title }}
                                                            </p>
                                                        </div>
                                                        <div class="mt-2 text-sm text-gray-700">
                                                            <p>{{ activity.description }}</p>
                                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 mt-1">
                                                                {{ activity.status }}
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                        {% empty %}
                                        <li class="text-center text-gray-500 py-8">
                                            <i class="fas fa-clock text-4xl mb-4 text-gray-300"></i>
                                            <p>–ù–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π</p>
                                        </li>
                                        {% endfor %}
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </main>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤
        function initProjectSelector() {
            const urlParams = new URLSearchParams(window.location.search);
            const projectId = urlParams.get('project_id');
            
            if (projectId) {
                const selector = document.getElementById('project-selector');
                if (selector) {
                    selector.value = projectId;
                }
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–≥–æ–¥—ã
        async function loadWeather(address) {
            console.log('Loading weather for:', address);
            
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π API wttr.in –¥–ª—è –ø–æ–≥–æ–¥—ã
                const response = await fetch(`https://wttr.in/–ú–æ—Å–∫–≤–∞?format=j1`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const data = await response.json();
                console.log('Weather data received:', data);
                
                if (data.current_condition && data.current_condition[0]) {
                    const current = data.current_condition[0];
                    return {
                        main: {
                            temp: Math.round(current.temp_C),
                            feels_like: Math.round(current.FeelsLikeC),
                            humidity: current.humidity
                        },
                        weather: [{
                            description: current.lang_ru && current.lang_ru[0] ? current.lang_ru[0].value : current.weatherDesc[0].value,
                            icon: getWeatherIcon(current.weatherCode)
                        }],
                        wind: {
                            speed: Math.round(parseFloat(current.windspeedKmph) / 3.6) // –∫–º/—á –≤ –º/—Å
                        }
                    };
                }
                
                throw new Error('Invalid weather data format');
                
            } catch (error) {
                console.error('Weather API failed, using mock data:', error);
                
                // –ú–æ–∫-–¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
                return {
                    main: {
                        temp: Math.floor(Math.random() * 20) + 5,  // –æ—Ç 5 –¥–æ 25¬∞C
                        feels_like: Math.floor(Math.random() * 20) + 7,
                        humidity: Math.floor(Math.random() * 40) + 40 // –æ—Ç 40 –¥–æ 80%
                    },
                    weather: [{
                        description: ['—è—Å–Ω–æ', '–æ–±–ª–∞—á–Ω–æ', '–º–∞–ª–æ–æ–±–ª–∞—á–Ω–æ', '–ø–∞—Å–º—É—Ä–Ω–æ'][Math.floor(Math.random() * 4)],
                        icon: ['‚òÄÔ∏è', '‚òÅÔ∏è', '‚õÖ', 'üå§Ô∏è'][Math.floor(Math.random() * 4)]
                    }],
                    wind: {
                        speed: Math.floor(Math.random() * 8) + 2 // –æ—Ç 2 –¥–æ 10 –º/—Å
                    }
                };
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∫–æ–Ω–∫–∏ –ø–æ–≥–æ–¥—ã
        function getWeatherIcon(weatherCode) {
            const icons = {
                '113': '‚òÄÔ∏è', // –Ø—Å–Ω–æ
                '116': '‚õÖ',   // –ú–∞–ª–æ–æ–±–ª–∞—á–Ω–æ
                '119': '‚òÅÔ∏è',   // –û–±–ª–∞—á–Ω–æ
                '122': '‚òÅÔ∏è',   // –ü–∞—Å–º—É—Ä–Ω–æ
                '143': 'üå´Ô∏è',   // –¢—É–º–∞–Ω
                '176': 'üå¶Ô∏è',   // –õ–µ–≥–∫–∏–π –¥–æ–∂–¥—å
                '179': 'üå®Ô∏è',   // –õ–µ–≥–∫–∏–π —Å–Ω–µ–≥
                '200': '‚õàÔ∏è',   // –ì—Ä–æ–∑–∞
                '263': 'üå¶Ô∏è',   // –õ–µ–≥–∫–∏–π –¥–æ–∂–¥—å
                '266': 'üå¶Ô∏è',   // –õ–µ–≥–∫–∏–π –¥–æ–∂–¥—å
                '293': 'üå¶Ô∏è',   // –õ–µ–≥–∫–∏–π –¥–æ–∂–¥—å
                '296': 'üå¶Ô∏è',   // –õ–µ–≥–∫–∏–π –¥–æ–∂–¥—å
                '299': 'üåßÔ∏è',   // –£–º–µ—Ä–µ–Ω–Ω—ã–π –¥–æ–∂–¥—å
                '302': 'üåßÔ∏è',   // –£–º–µ—Ä–µ–Ω–Ω—ã–π –¥–æ–∂–¥—å
                '305': 'üåßÔ∏è',   // –°–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å
                '308': 'üåßÔ∏è',   // –°–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å
                '320': 'üå®Ô∏è',   // –õ–µ–≥–∫–∏–π —Å–Ω–µ–≥
                '323': 'üå®Ô∏è',   // –õ–µ–≥–∫–∏–π —Å–Ω–µ–≥
                '326': 'üå®Ô∏è',   // –õ–µ–≥–∫–∏–π —Å–Ω–µ–≥
                '329': 'üå®Ô∏è',   // –£–º–µ—Ä–µ–Ω–Ω—ã–π —Å–Ω–µ–≥
                '332': 'üå®Ô∏è',   // –£–º–µ—Ä–µ–Ω–Ω—ã–π —Å–Ω–µ–≥
                '335': 'üå®Ô∏è',   // –°–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥
                '338': 'üå®Ô∏è',   // –°–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥
                '386': '‚õàÔ∏è',   // –ì—Ä–æ–∑–∞ —Å –¥–æ–∂–¥–µ–º
                '389': '‚õàÔ∏è',   // –ì—Ä–æ–∑–∞ —Å –¥–æ–∂–¥–µ–º
                '392': '‚õàÔ∏è',   // –ì—Ä–æ–∑–∞ —Å —Å–Ω–µ–≥–æ–º
                '395': '‚õàÔ∏è'    // –ì—Ä–æ–∑–∞ —Å —Å–Ω–µ–≥–æ–º
            };
            
            return icons[weatherCode] || 'üå§Ô∏è'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã
        function displayWeather(data) {
            console.log('Displaying weather data:', data);
            
            document.getElementById('weather-temp').textContent = Math.round(data.main.temp) + '¬∞C';
            document.getElementById('weather-desc').textContent = data.weather[0].description;
            document.getElementById('weather-feels').textContent = Math.round(data.main.feels_like) + '¬∞C';
            document.getElementById('weather-humidity').textContent = data.main.humidity + '%';
            document.getElementById('weather-wind').textContent = Math.round(data.wind.speed) + ' –º/—Å';
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏–∫–æ–Ω–∫—É –∏–∑ API –∏–ª–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é
            const iconElement = document.getElementById('weather-icon');
            if (iconElement) {
                iconElement.textContent = data.weather[0].icon || 'üå§Ô∏è';
            }
            
            document.getElementById('weather-loading').classList.add('hidden');
            document.getElementById('weather-content').classList.remove('hidden');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Gantt –≥—Ä–∞—Ñ–∏–∫–∞
        function initializeGanttChart() {
            const ganttChart = document.getElementById('gantt-chart');
            if (!ganttChart) return;
            
            const ganttBars = document.querySelectorAll('.gantt-bar');
            if (ganttBars.length === 0) return;
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
            let projectStart = null;
            let projectEnd = null;
            
            ganttBars.forEach(bar => {
                const start = new Date(bar.dataset.start);
                const end = new Date(bar.dataset.end);
                
                if (!projectStart || start < projectStart) projectStart = start;
                if (!projectEnd || end > projectEnd) projectEnd = end;
            });
            
            if (!projectStart || !projectEnd) return;
            
            // –í—ã—á–∏—Å–ª—è–µ–º –æ–±—â—É—é –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞
            const totalDays = Math.ceil((projectEnd - projectStart) / (1000 * 60 * 60 * 24)) + 1;
            
            // –°–æ–∑–¥–∞–µ–º —Å–µ—Ç–∫—É –¥–∞—Ç
            const timelineHeader = document.getElementById('timeline-header');
            if (timelineHeader) {
                timelineHeader.innerHTML = '';
                timelineHeader.style.gridTemplateColumns = `repeat(${Math.min(totalDays, 30)}, 1fr)`;
                
                for (let i = 0; i < Math.min(totalDays, 30); i++) {
                    const date = new Date(projectStart);
                    date.setDate(projectStart.getDate() + i);
                    
                    const dateCell = document.createElement('div');
                    dateCell.className = 'text-center text-xs text-gray-600 p-1 border-r border-gray-200';
                    dateCell.innerHTML = `
                        <div class="font-medium">${date.getDate()}</div>
                        <div class="text-gray-400">${date.toLocaleDateString('ru', { month: 'short' })}</div>
                    `;
                    timelineHeader.appendChild(dateCell);
                }
            }
            
            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –ø–æ–ª–æ—Å—ã —Ä–∞–±–æ—Ç
            ganttBars.forEach(bar => {
                const start = new Date(bar.dataset.start);
                const end = new Date(bar.dataset.end);
                const duration = parseInt(bar.dataset.duration);
                const progress = parseInt(bar.dataset.progress);
                
                // –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∏ —à–∏—Ä–∏–Ω—É
                const startOffset = Math.ceil((start - projectStart) / (1000 * 60 * 60 * 24));
                const widthPercent = Math.min((duration / Math.min(totalDays, 30)) * 100, 100);
                const leftPercent = (startOffset / Math.min(totalDays, 30)) * 100;
                
                bar.style.left = leftPercent + '%';
                bar.style.width = widthPercent + '%';
                
                // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–æ—Å—É –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                if (progress > 0 && progress < 100) {
                    const progressBar = document.createElement('div');
                    progressBar.className = 'absolute top-0 left-0 h-full bg-black bg-opacity-20 rounded';
                    progressBar.style.width = (100 - progress) + '%';
                    progressBar.style.right = '0';
                    progressBar.style.left = 'auto';
                    bar.appendChild(progressBar);
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç—É–ª—Ç–∏–ø
                bar.title = `–ù–∞—á–∞–ª–æ: ${start.toLocaleDateString('ru')}\n–û–∫–æ–Ω—á–∞–Ω–∏–µ: ${end.toLocaleDateString('ru')}\n–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${duration} –¥–Ω.\n–ü—Ä–æ–≥—Ä–µ—Å—Å: ${progress}%`;
            });
        }
        
        // üá∫üá∏ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–æ—Å—Å–∏–π—Å–∫–æ–π –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤
            initProjectSelector();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Gantt –≥—Ä–∞—Ñ–∏–∫
            initializeGanttChart();
            
            // –°–æ–∑–¥–∞–µ–º —Ä–æ—Å—Å–∏–π—Å–∫—É—é –∫–∞—Ä—Ç—É –±–µ–∑ –±—Ä–µ–Ω–¥–∏–Ω–≥–∞
            let map = null;
            
            try {
                console.log('üó∫Ô∏è –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã –±–µ–∑ –±—Ä–µ–Ω–¥–∏–Ω–≥–∞...');
                
                map = createRussianMap('map', {
                    center: [37.6176, 55.7558], // –ú–æ—Å–∫–≤–∞
                    zoom: 10,
                    debug: true,
                    defaultProvider: 'osm'
                });
                
                // –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–æ–≤
                const projectsData = {{ projects_for_map|safe }};
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫–∞—Ä—Ç—ã
                document.getElementById('map').addEventListener('mapReady', function(e) {
                    console.log('‚úÖ –ö–∞—Ä—Ç–∞ –≥–æ—Ç–æ–≤–∞!');
                    
                    
                    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø—Ä–æ–µ–∫—Ç—ã
                    if (projectsData.length === 0) {
                        console.warn('‚ö†Ô∏è –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è');
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä –ú–æ—Å–∫–≤—ã
                        map.addMarker([37.6176, 55.7558], {
                            title: '–ú–æ—Å–∫–≤–∞',
                            color: '#2942F9',
                            popup: `
                                <div class="p-3">
                                    <h4 class="font-bold text-sm mb-2">üè≤ –ú–æ—Å–∫–≤–∞</h4>
                                    <p class="text-xs text-gray-600">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
                                </div>
                            `
                        });
                        return;
                    }
                    
                    console.log(`üè¢ –û—Ç–æ–±—Ä–∞–∂–∞–µ–º ${projectsData.length} –ø—Ä–æ–µ–∫—Ç(–æ–≤) –Ω–∞ –∫–∞—Ä—Ç–µ`);
                    
                    projectsData.forEach(function(project, index) {
                        try {
                            let color = '#151E3F';
                            if (project.status === 'active') color = '#2942F9';
                            else if (project.status === 'completed') color = '#FFA586';
                            else if (project.status === 'suspended') color = '#A51A2B';
                            else if (project.status === 'planned') color = '#384358';
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
                            if (project.coordinates) {
                                let geoData = project.coordinates;
                                
                                // –ü–∞—Ä—Å–∏–º —Å—Ç—Ä–æ–∫–∏ –≤ JSON
                                if (typeof geoData === 'string') {
                                    try {
                                        geoData = JSON.parse(geoData);
                                    } catch (e) {
                                        console.warn('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:', project.name, e);
                                        return;
                                    }
                                }
                                
                                if (geoData && geoData.type && geoData.coordinates) {
                                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç –ø–æ –ø—Ä–æ–≥—Ä–µ—Å—Å—É
                                    let fillColor = color;
                                    if (project.completion >= 90) {
                                        fillColor = '#10b981'; // –ó–µ–ª–µ–Ω—ã–π
                                    } else if (project.completion >= 50) {
                                        fillColor = '#f59e0b'; // –û—Ä–∞–Ω–∂–µ–≤—ã–π
                                    }
                                    
                                    // –í—ã—á–∏—Å–ª—è–µ–º —Ü–µ–Ω—Ç—Ä
                                    let centerLng, centerLat;
                                    if (geoData.type === 'Polygon') {
                                        const coords = geoData.coordinates[0];
                                        centerLng = coords.reduce((sum, coord) => sum + coord[0], 0) / coords.length;
                                        centerLat = coords.reduce((sum, coord) => sum + coord[1], 0) / coords.length;
                                    } else if (geoData.type === 'Point') {
                                        centerLng = geoData.coordinates[0];
                                        centerLat = geoData.coordinates[1];
                                    } else {
                                        centerLng = 37.6176;
                                        centerLat = 55.7558;
                                    }
                                    
                                    // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä
                                    map.addMarker([centerLng, centerLat], {
                                        title: project.name,
                                        color: color,
                                        popup: `
                                            <div class="p-4 max-w-sm">
                                                <h4 class="font-bold text-base mb-2 text-gray-800">${project.name}</h4>
                                                <p class="text-xs text-gray-600 mb-3">üìç ${project.address || '–ê–¥—Ä–µ—Å –Ω–µ —É–∫–∞–∑–∞–Ω'}</p>
                                                
                                                <div class="flex items-center justify-between mb-3">
                                                    <span class="text-xs px-2 py-1 rounded-full font-medium" style="background-color: ${color}20; color: ${color}">
                                                        ${project.status === 'active' ? '–ê–∫—Ç–∏–≤–µ–Ω' : 
                                                          project.status === 'completed' ? '–ó–∞–≤–µ—Ä—à–µ–Ω' :
                                                          project.status === 'planned' ? '–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è' : '–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}
                                                    </span>
                                                    <div class="flex items-center">
                                                        <div class="w-12 h-2 bg-gray-200 rounded-full mr-2">
                                                            <div class="h-2 rounded-full" style="width: ${project.completion}%; background-color: ${fillColor}"></div>
                                                        </div>
                                                        <span class="text-xs font-bold text-gray-700">${project.completion}%</span>
                                                    </div>
                                                </div>
                                                
                                                ${project.control_service ? `<p class="text-xs text-gray-600 mb-1">üë• <strong>–ö–æ–Ω—Ç—Ä–æ–ª—å:</strong> ${project.control_service}</p>` : ''}
                                                ${project.foreman ? `<p class="text-xs text-gray-600 mb-1">üë∑ <strong>–ü—Ä–æ—Ä–∞–±:</strong> ${project.foreman}</p>` : ''}
                                                
                                                <div class="mt-3 pt-2 border-t border-gray-200">
                                                    <button onclick="selectProject(${project.id})" class="text-xs bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-md transition-colors">
                                                        üîç –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                                    </button>
                                                </div>
                                            </div>
                                        `,
                                        data: project
                                    });
                                    
                                    // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–∏–≥–æ–Ω (–µ—Å–ª–∏ —ç—Ç–æ Polygon)
                                    if (geoData.type === 'Polygon') {
                                        map.addPolygon(geoData.coordinates[0], {
                                            title: project.name,
                                            strokeColor: color,
                                            fillColor: fillColor + '50', // –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
                                            strokeWidth: 2,
                                            data: project
                                        });
                                    }
                                    
                                    // –§–æ–∫—É—Å –Ω–∞ –æ–¥–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ
                                    if (projectsData.length === 1) {
                                        map.setCenter([centerLng, centerLat], 12);
                                    }
                                }
                            } else {
                                // –ü—Ä–æ–µ–∫—Ç—ã –±–µ–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç - —Å–ª—É—á–∞–π–Ω–æ–µ –º–µ—Å—Ç–æ –≤ –ú–æ—Å–∫–≤–µ
                                const offsetLng = 37.6176 + (Math.random() - 0.5) * 0.1;
                                const offsetLat = 55.7558 + (Math.random() - 0.5) * 0.1;
                                
                                map.addMarker([offsetLng, offsetLat], {
                                    title: project.name,
                                    color: color,
                                    popup: `
                                        <div class="p-3">
                                            <h4 class="font-bold text-sm mb-2 text-gray-800">${project.name}</h4>
                                            <p class="text-xs text-gray-600 mb-2">${project.address || '–ê–¥—Ä–µ—Å –Ω–µ —É–∫–∞–∑–∞–Ω'}</p>
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-xs px-2 py-1 rounded" style="background-color: ${color}20; color: ${color}">
                                                    ${project.status}
                                                </span>
                                                <span class="text-xs font-medium text-gray-700">${project.completion}%</span>
                                            </div>
                                            <p class="text-xs text-orange-600">‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ –∑–∞–¥–∞–Ω—ã</p>
                                            ${project.control_service ? `<p class="text-xs text-gray-600"><strong>–ö–æ–Ω—Ç—Ä–æ–ª—å:</strong> ${project.control_service}</p>` : ''}
                                            ${project.foreman ? `<p class="text-xs text-gray-600"><strong>–ü—Ä–æ—Ä–∞–±:</strong> ${project.foreman}</p>` : ''}
                                        </div>
                                    `,
                                    data: project
                                });
                                
                                if (projectsData.length === 1) {
                                    map.setCenter([offsetLng, offsetLat], 12);
                                }
                            }
                        } catch (e) {
                            console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –∫–∞—Ä—Ç—É:', project.name, e);
                        }
                    });
                });
                
            } catch (error) {
                console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç—ã:', error);
                document.getElementById('map-loading').innerHTML = `
                    <div class="flex items-center justify-center h-96 bg-gray-100">
                        <div class="text-center">
                            <div class="text-6xl mb-4">‚ùå</div>
                            <h3 class="text-xl font-bold text-gray-900 mb-2">–û—à–∏–±–∫–∞ –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã</h3>
                            <p class="text-sm text-gray-600 mb-4">${error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</p>
                            <button onclick="location.reload()" class="px-4 py-2 bg-primary-blue text-white rounded hover:bg-blue-600">
                                üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
                            </button>
                        </div>
                    </div>
                `;
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–≥–æ–¥—É: –∞–¥—Ä–µ—Å –ø—Ä–æ–µ–∫—Ç–∞ –∏–ª–∏ –ú–æ—Å–∫–≤–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            {% if selected_project %}
                const weatherAddress = '{{ selected_project.address|escapejs }}' || '–ú–æ—Å–∫–≤–∞';
            {% else %}
                const weatherAddress = '–ú–æ—Å–∫–≤–∞';
            {% endif %}
            loadWeather(weatherAddress)
                .then(displayWeather)
                .catch(error => {
                    console.error('Weather error:', error);
                    document.getElementById('weather-loading').classList.add('hidden');
                    document.getElementById('weather-error').classList.remove('hidden');
                });
        });
        
        // –û—Ç–ª–∞–¥—á–∏–∫ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —Å–µ–ª–µ–∫—Ç–æ—Ä–∞
        const projectSelector = document.getElementById('project-selector');
        if (projectSelector) {
            console.log('Project selector found:', projectSelector);
            projectSelector.addEventListener('change', function(e) {
                console.log('Selector change event fired:', e.target.value);
            });
        } else {
            console.error('Project selector not found!');
        }
        
        // –î–æ—Å—Ç—É–ø –∫ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
        window.selectProject = selectProject;
        console.log('selectProject function exposed globally:', typeof window.selectProject);
    </script>
</body>
</html>
