{% extends 'base.html' %}

{% block title %}–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏–µ - –ò–Ω—Å–ø–µ–∫—Ç–æ—Ä{% endblock %}

{% block extra_css %}
<style>
  #reader {
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
  }
  
  #reader__scan_region {
    border-radius: 12px;
    border: 2px solid #e5e5e5;
  }
  
  #reader__dashboard_section {
    display: none !important;
  }
  
  .verification-status {
    animation: fadeIn 0.5s ease-in;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  /* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
  .modal-enter {
    animation: modalEnter 0.3s ease-out;
  }
  
  @keyframes modalEnter {
    from { 
      opacity: 0; 
      transform: translate(-50%, -60%) scale(0.9);
    }
    to { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1);
    }
  }
  
  /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
  .btn-primary {
    @apply bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold py-3 px-6 rounded-xl shadow-lg transform hover:scale-105 transition-all duration-200;
  }
  
  .btn-secondary {
    @apply bg-white border-2 border-gray-300 hover:border-gray-400 text-gray-700 font-medium py-3 px-6 rounded-xl shadow-sm hover:bg-gray-50 transition-all duration-200;
  }
  
  .btn-success {
    @apply bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-semibold py-2 px-4 rounded-lg shadow-md transform hover:scale-105 transition-all duration-200;
  }
  
  .btn-warning {
    @apply bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-semibold py-2 px-4 rounded-lg shadow-md transform hover:scale-105 transition-all duration-200;
  }
</style>
{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto space-y-8">
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
  <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl p-6 text-white">
    <div class="flex items-center justify-between">
      <div class="flex items-center">
        <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center mr-4">
          <i class="fas fa-exclamation-triangle text-2xl"></i>
        </div>
        <div>
          <h1 class="text-2xl font-bold">–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏–µ</h1>
          <p class="text-blue-100 mt-1">–í–Ω–µ—Å–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –Ω–∞—Ä—É—à–µ–Ω–∏—è –≤ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –∂—É—Ä–Ω–∞–ª</p>
        </div>
      </div>
      <a href="{% url 'inspector:dashboard' %}" 
         class="inline-flex items-center px-4 py-2 bg-white bg-opacity-20 rounded-lg text-white hover:bg-opacity-30 transition-colors">
        <i class="fas fa-arrow-left mr-2"></i>
        –ù–∞–∑–∞–¥
      </a>
    </div>
  </div>

  <form method="post" enctype="multipart/form-data" class="space-y-8" id="violation-form" data-geolocation="true">
    {% csrf_token %}
    
    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
      <div class="bg-gradient-to-r from-blue-50 to-indigo-50 px-6 py-4 border-b border-gray-200">
        <h2 class="text-lg font-semibold text-gray-900 flex items-center">
          <i class="fas fa-info-circle text-blue-500 mr-2"></i>
          –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        </h2>
      </div>
      <div class="p-6 space-y-6">
        <!-- –ü—Ä–æ–µ–∫—Ç -->
        <div>
          <label for="project_id" class="block text-sm font-medium text-gray-700">
            –ü—Ä–æ–µ–∫—Ç <span class="text-red-500">*</span>
          </label>
          <select name="project_id" id="project_id" required 
                  class="mt-2 block w-full px-4 py-3 border-2 border-gray-200 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç</option>
            {% for project in projects %}
              <option value="{{ project.id }}" {% if request.GET.project == project.id|stringformat:"s" %}selected{% endif %}>
                {{ project.name }} - {{ project.address }}
              </option>
            {% endfor %}
          </select>
        </div>

        <!-- –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –Ω–∞—Ä—É—à–µ–Ω–∏–π –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç -->
        <div>
          <label for="violation_classifier_id" class="block text-sm font-medium text-gray-700">
            –¢–∏–ø –∑–∞–º–µ—á–∞–Ω–∏—è üìã <span class="text-red-500">*</span>
          </label>
          <select name="violation_classifier_id" id="violation_classifier_id" required
                  class="mt-2 block w-full px-4 py-3 border-2 border-gray-200 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∑–∞–º–µ—á–∞–Ω–∏—è</option>
            {% for classifier in violation_classifiers %}
              <option value="{{ classifier.id }}"
                      data-category="{{ classifier.category }}"
                      data-kind="{{ classifier.kind }}"
                      data-type="{{ classifier.type_name }}"
                      data-deadline-days="{{ classifier.regulatory_deadline_days }}">
                {{ classifier.category }} | {{ classifier.kind }} | {{ classifier.type_name }} - {{ classifier.name|truncatechars:60 }}
              </option>
            {% endfor %}
          </select>
          <p class="mt-1 text-sm text-gray-500" id="classifier-description">
            –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–º–µ—á–∞–Ω–∏–µ –∏–∑ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è
          </p>
        </div>

        <!-- –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ -->
        <div>
          <label for="title" class="block text-sm font-medium text-gray-700">
            –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ <span class="text-red-500">*</span>
          </label>
          <input type="text" name="title" id="title" required maxlength="255"
                 class="mt-2 block w-full px-4 py-3 border-2 border-gray-200 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                 placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ù–∞—Ä—É—à–µ–Ω–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ —É–∫–ª–∞–¥–∫–∏ –∞—Å—Ñ–∞–ª—å—Ç–∞">
        </div>

        <!-- –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ -->
        <div>
          <label for="description" class="block text-sm font-medium text-gray-700">
            –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è <span class="text-red-500">*</span>
          </label>
          <textarea name="description" id="description" rows="4" required
                    class="mt-2 block w-full px-4 py-3 border-2 border-gray-200 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all resize-none"
                    placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—ã—è–≤–ª–µ–Ω–Ω–æ–≥–æ –Ω–∞—Ä—É—à–µ–Ω–∏—è, –≤–∫–ª—é—á–∞—è –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞ –∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è"></textarea>
        </div>

        <!-- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏ —Å—Ä–æ–∫ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="priority" class="block text-sm font-medium text-gray-700">
              –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç
            </label>
            <select name="priority" id="priority" 
                    class="mt-2 block w-full px-4 py-3 border-2 border-gray-200 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
              {% for value, label in priorities %}
                <option value="{{ value }}" {% if value == 'medium' %}selected{% endif %}>{{ label }}</option>
              {% endfor %}
            </select>
          </div>
          <div>
            <label for="deadline_days" class="block text-sm font-medium text-gray-700">
              –°—Ä–æ–∫ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è (–¥–Ω–∏)
            </label>
            <input type="number" name="deadline_days" id="deadline_days" min="1" max="365" value="30"
                   class="mt-2 block w-full px-4 py-3 border-2 border-gray-200 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
          </div>
        </div>

        <!-- –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ -->
        <div>
          <label for="assigned_to" class="block text-sm font-medium text-gray-700">
            –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ
          </label>
          <select name="assigned_to" id="assigned_to" 
                  class="mt-2 block w-full px-4 py-3 border-2 border-gray-200 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
            <option value="">–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω</option>
            {% for assignee in potential_assignees %}
              <option value="{{ assignee.id }}">
                {{ assignee.get_full_name }} ({{ assignee.get_user_type_display }})
              </option>
            {% endfor %}
          </select>
          <p class="mt-1 text-sm text-gray-500">–ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ, –Ω–∞—Ä—É—à–µ–Ω–∏–µ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–º—É</p>
        </div>
      </div>
    </div>

    <!-- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –Ω–∞ –æ–±—ä–µ–∫—Ç–µ -->
    <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
      <div class="bg-gradient-to-r from-orange-50 to-red-50 px-6 py-4 border-b border-gray-200">
        <h2 class="text-lg font-semibold text-gray-900 flex items-center">
          <i class="fas fa-shield-check text-orange-500 mr-2"></i>
          –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –Ω–∞ –æ–±—ä–µ–∫—Ç–µ
          <span class="text-red-500">*</span>
        </h2>
        <p class="text-sm text-orange-700 mt-1">–î–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è –Ω–∞ –æ–±—ä–µ–∫—Ç–µ</p>
      </div>
      <div class="p-6">
        <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- QR-–∫–æ–¥ -->
          <div class="border-2 border-dashed border-orange-200 rounded-xl p-6 hover:border-orange-300 transition-all">
            <div class="text-center">
              <div class="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center mx-auto mb-3">
                <i class="fas fa-qrcode text-orange-500 text-xl"></i>
              </div>
              <h3 class="font-semibold text-gray-900 mb-2">–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ QR-–∫–æ–¥–∞</h3>
              <p class="text-sm text-gray-600 mb-4">–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥, —Ä–∞–∑–º–µ—â–µ–Ω–Ω—ã–π –Ω–∞ –æ–±—ä–µ–∫—Ç–µ</p>
              <button type="button" id="start-qr-scanner" 
                      class="btn-warning">
                <i class="fas fa-camera mr-2"></i>
                –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥
              </button>
            </div>
          </div>
          
          <!-- –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è -->
          <div class="border-2 border-dashed border-green-200 rounded-xl p-6 hover:border-green-300 transition-all">
            <div class="text-center">
              <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center mx-auto mb-3">
                <i class="fas fa-map-marker-alt text-green-500 text-xl"></i>
              </div>
              <h3 class="font-semibold text-gray-900 mb-2">–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è</h3>
              <p class="text-sm text-gray-600 mb-4">–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
              <button type="button" id="get-location" 
                      class="btn-success">
                <i class="fas fa-crosshairs mr-2"></i>
                –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ
              </button>
            </div>
          </div>
        </div>
        
        <!-- –°—Ç–∞—Ç—É—Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
        <div id="verification-status" class="mt-6"></div>
        
        <!-- QR Scanner -->
        <div id="qr-scanner-container" class="mt-6" style="display: none;">
          <div class="bg-gray-50 rounded-xl p-6">
            <div class="flex items-center justify-between mb-4">
              <h4 class="font-medium text-gray-900">–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ QR-–∫–æ–¥</h4>
              <button type="button" id="close-qr-scanner" 
                      class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-200 transition-colors">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div id="reader"></div>
            <div id="qr-result" class="mt-4"></div>
          </div>
        </div>
        
        <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
        <input type="hidden" id="verification_type" name="verification_type" value="">
        <input type="hidden" id="qr_code_id" name="qr_code_id" value="">
      </div>
    </div>

    <!-- –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è -->
    <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
      <div class="bg-gradient-to-r from-green-50 to-emerald-50 px-6 py-4 border-b border-gray-200">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold text-gray-900 flex items-center">
            <i class="fas fa-map-marker-alt text-green-500 mr-2"></i>
            –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è
          </h2>
        </div>
        <p class="text-sm text-green-700 mt-1">–£–∫–∞–∂–∏—Ç–µ —Ç–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Ä—É—à–µ–Ω–∏—è (–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –º–µ—Å—Ç–æ–Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è)</p>
      </div>
      <div class="p-6 space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="latitude" class="block text-sm font-medium text-gray-700">–®–∏—Ä–æ—Ç–∞</label>
            <input type="number" step="any" name="latitude" id="latitude" readonly
                   class="mt-2 block w-full px-4 py-3 border-2 border-gray-200 rounded-xl shadow-sm bg-gray-50 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all"
                   placeholder="–ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏">
          </div>
          <div>
            <label for="longitude" class="block text-sm font-medium text-gray-700">–î–æ–ª–≥–æ—Ç–∞</label>
            <input type="number" step="any" name="longitude" id="longitude" readonly
                   class="mt-2 block w-full px-4 py-3 border-2 border-gray-200 rounded-xl shadow-sm bg-gray-50 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all"
                   placeholder="–ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏">
          </div>
        </div>
        <div>
          <label for="location_description" class="block text-sm font-medium text-gray-700">
            –û–ø–∏—Å–∞–Ω–∏–µ –º–µ—Å—Ç–∞
          </label>
          <input type="text" name="location_description" id="location_description" maxlength="500"
                 class="mt-2 block w-full px-4 py-3 border-2 border-gray-200 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all"
                 placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 50 –º –æ—Ç –≤—Ö–æ–¥–∞ –≤ –ø–∞—Ä–∫, —É –¥–µ—Ç—Å–∫–æ–π –ø–ª–æ—â–∞–¥–∫–∏">
        </div>
      </div>
    </div>

    <!-- –§–æ—Ç–æ–º–∞—Ç–µ—Ä–∏–∞–ª—ã -->
    <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
      <div class="bg-gradient-to-r from-purple-50 to-violet-50 px-6 py-4 border-b border-gray-200">
        <h2 class="text-lg font-semibold text-gray-900 flex items-center">
          <i class="fas fa-camera text-purple-500 mr-2"></i>
          –§–æ—Ç–æ–º–∞—Ç–µ—Ä–∏–∞–ª—ã
          <span class="text-red-500" id="photos-required" style="display: none;">*</span>
        </h2>
        <p class="text-sm text-purple-700 mt-1">–ü—Ä–∏–ª–æ–∂–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è</p>
      </div>
      <div class="p-6 space-y-4">
        <div class="border-2 border-dashed border-purple-200 rounded-xl p-8 hover:border-purple-300 hover:bg-purple-50 transition-all duration-200 bg-gradient-to-br from-purple-25 to-white">
          <div class="text-center">
            <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="fas fa-cloud-upload-alt text-2xl text-purple-500"></i>
            </div>
            <div class="mt-4">
              <label for="photos" class="cursor-pointer">
                <span class="block text-base font-semibold text-gray-900 mb-2">
                  –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
                </span>
                <span class="text-sm text-gray-600">
                  –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞
                </span>
                <input id="photos" name="photos" type="file" accept="image/*" multiple class="sr-only" onchange="handleFileSelect(event)">
              </label>
              <p class="mt-3 text-xs text-gray-500 bg-gray-50 px-3 py-2 rounded-lg inline-block">
                <i class="fas fa-info-circle mr-1"></i>
                PNG, JPG –¥–æ 10MB –∫–∞–∂–¥—ã–π ‚Ä¢ –ù–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤
              </p>
            </div>
          </div>
        </div>
        
        <!-- –ü—Ä–µ–≤—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ -->
        <div id="photos-preview" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
      </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
    <div class="flex flex-col sm:flex-row sm:justify-end space-y-3 sm:space-y-0 sm:space-x-4 pt-8">
      <a href="{% url 'inspector:dashboard' %}" 
         class="btn-secondary inline-flex items-center justify-center">
        <i class="fas fa-times mr-2"></i>
        –û—Ç–º–µ–Ω–∞
      </a>
      <button type="submit" 
              class="btn-primary inline-flex items-center justify-center">
        <i class="fas fa-exclamation-triangle mr-2"></i>
        –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏–µ
      </button>
    </div>
  </form>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
<div id="notification-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
  <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-xl bg-white">
    <div class="mt-3">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center">
          <div id="notification-icon" class="w-10 h-10 rounded-full flex items-center justify-center mr-3">
            <i id="notification-icon-el" class="text-xl"></i>
          </div>
          <h3 id="notification-title" class="text-lg font-medium text-gray-900"></h3>
        </div>
        <button onclick="closeNotificationModal()" class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-gray-200 transition-colors">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div id="notification-body" class="text-sm text-gray-600 mb-6"></div>
      <div id="notification-buttons" class="flex justify-end space-x-3"></div>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
<div id="confirm-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
  <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-xl bg-white">
    <div class="mt-3">
      <div class="flex items-center mb-4">
        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
          <i class="fas fa-question-circle text-blue-500 text-xl"></i>
        </div>
        <h3 id="confirm-title" class="text-lg font-medium text-gray-900">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ</h3>
      </div>
      <div id="confirm-body" class="text-sm text-gray-600 mb-6"></div>
      <div class="flex justify-end space-x-3">
        <button onclick="closeConfirmModal()" 
                class="px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors">
          –û—Ç–º–µ–Ω–∞
        </button>
        <button id="confirm-button" 
                class="px-4 py-2 bg-blue-600 border border-transparent rounded-lg text-sm font-medium text-white hover:bg-blue-700 transform hover:scale-105 transition-all duration-200">
          –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
        </button>
      </div>
    </div>
  </div>
</div>

<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è QR-—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

<script>
let selectedFiles = [];
let html5QrCode = null;
let isVerified = false;
let confirmCallback = null;

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫—Ä–∞—Å–∏–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
function showNotification(title, message, type = 'info') {
    const modal = document.getElementById('notification-modal');
    const modalContent = modal.querySelector('.relative');
    const titleEl = document.getElementById('notification-title');
    const bodyEl = document.getElementById('notification-body');
    const iconEl = document.getElementById('notification-icon');
    const iconIconEl = document.getElementById('notification-icon-el');
    const buttonsEl = document.getElementById('notification-buttons');
    
    titleEl.textContent = title;
    bodyEl.textContent = message;
    
    // –û—á–∏—â–∞–µ–º –∫–ª–∞—Å—Å—ã
    iconEl.className = 'w-10 h-10 rounded-full flex items-center justify-center mr-3';
    iconIconEl.className = 'text-xl';
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∏–ª–∏ –ø–æ —Ç–∏–ø—É
    if (type === 'error') {
        iconEl.classList.add('bg-red-100');
        iconIconEl.classList.add('fas', 'fa-exclamation-circle', 'text-red-500');
    } else if (type === 'success') {
        iconEl.classList.add('bg-green-100');
        iconIconEl.classList.add('fas', 'fa-check-circle', 'text-green-500');
    } else if (type === 'warning') {
        iconEl.classList.add('bg-yellow-100');
        iconIconEl.classList.add('fas', 'fa-exclamation-triangle', 'text-yellow-500');
    } else {
        iconEl.classList.add('bg-blue-100');
        iconIconEl.classList.add('fas', 'fa-info-circle', 'text-blue-500');
    }
    
    // –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
    buttonsEl.innerHTML = `
        <button onclick="closeNotificationModal()" 
                class="px-4 py-2 bg-blue-600 border border-transparent rounded-lg text-sm font-medium text-white hover:bg-blue-700 transform hover:scale-105 transition-all duration-200">
            –ü–æ–Ω—è—Ç–Ω–æ
        </button>
    `;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
    modalContent.classList.add('modal-enter');
    modal.classList.remove('hidden');
    
    // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    setTimeout(() => {
        modalContent.classList.remove('modal-enter');
    }, 300);
}

function closeNotificationModal() {
    document.getElementById('notification-modal').classList.add('hidden');
}

function showConfirm(title, message, callback) {
    const modal = document.getElementById('confirm-modal');
    const modalContent = modal.querySelector('.relative');
    const titleEl = document.getElementById('confirm-title');
    const bodyEl = document.getElementById('confirm-body');
    
    titleEl.textContent = title;
    bodyEl.textContent = message;
    confirmCallback = callback;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
    modalContent.classList.add('modal-enter');
    modal.classList.remove('hidden');
    
    // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    setTimeout(() => {
        modalContent.classList.remove('modal-enter');
    }, 300);
}

function closeConfirmModal() {
    document.getElementById('confirm-modal').classList.add('hidden');
    confirmCallback = null;
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
document.getElementById('confirm-button').addEventListener('click', function() {
    if (confirmCallback) {
        confirmCallback();
    }
    closeConfirmModal();
});

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–µ –Ω–∞—Ä—É—à–µ–Ω–∏–π
document.getElementById('violation_classifier_id').addEventListener('change', function() {
    const selectedOption = this.options[this.selectedIndex];
    const category = selectedOption.dataset.category;
    const kind = selectedOption.dataset.kind;
    const type = selectedOption.dataset.type;
    const deadlineDays = selectedOption.dataset.deadlineDays;
    
    const descriptionEl = document.getElementById('classifier-description');
    if (this.value) {
        descriptionEl.textContent = `–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${category}, –≤–∏–¥: ${kind}, —Ç–∏–ø: ${type}. –°—Ä–æ–∫: ${deadlineDays ? deadlineDays + ' –¥–Ω.' : '–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}`;
        descriptionEl.className = 'mt-1 text-sm text-green-600';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ä–æ–∫ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞
        if (deadlineDays && deadlineDays !== 'None') {
            document.getElementById('deadline_days').value = deadlineDays;
        } else {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ä–æ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (30 –¥–Ω–µ–π)
            document.getElementById('deadline_days').value = 30;
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫, –µ—Å–ª–∏ –æ–Ω –ø—É—Å—Ç–æ–π
        const titleField = document.getElementById('title');
        if (!titleField.value.trim()) {
            const shortName = selectedOption.textContent.split(' - ')[1] || selectedOption.textContent;
            titleField.value = shortName.length > 100 ? shortName.substring(0, 100) + '...' : shortName;
        }
    } else {
        descriptionEl.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–º–µ—á–∞–Ω–∏–µ –∏–∑ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è';
        descriptionEl.className = 'mt-1 text-sm text-gray-500';
    }
});

// QR-—Å–∫–∞–Ω–µ—Ä
document.getElementById('start-qr-scanner').addEventListener('click', function() {
    startQRScanner();
});

document.getElementById('close-qr-scanner').addEventListener('click', function() {
    stopQRScanner();
});

function startQRScanner() {
    const container = document.getElementById('qr-scanner-container');
    container.style.display = 'block';
    
    html5QrCode = new Html5Qrcode("reader");
    
    Html5Qrcode.getCameras().then(devices => {
        if (devices && devices.length) {
            const cameraId = devices[0].id;
            
            html5QrCode.start(
                cameraId,
                {
                    fps: 10,
                    qrbox: { width: 250, height: 250 }
                },
                (decodedText, decodedResult) => {
                    // QR-–∫–æ–¥ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–Ω
                    verifyQRCode(decodedText);
                },
                (errorMessage) => {
                    // –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è (–æ–±—ã—á–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)
                }
            ).catch(err => {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∫–∞–º–µ—Ä—ã:', err);
                showVerificationStatus('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ: ' + err, 'error');
            });
        } else {
            showVerificationStatus('–ö–∞–º–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
        }
    }).catch(err => {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∫–∞–º–µ—Ä:', err);
        showVerificationStatus('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–∞–º: ' + err, 'error');
    });
}

function stopQRScanner() {
    if (html5QrCode) {
        html5QrCode.stop().then(() => {
            document.getElementById('qr-scanner-container').style.display = 'none';
            html5QrCode = null;
        }).catch(err => {
            console.error('–û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–∫–∞–Ω–µ—Ä–∞:', err);
        });
    } else {
        document.getElementById('qr-scanner-container').style.display = 'none';
    }
}

async function verifyQRCode(qrCodeText) {
    try {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é QR-–∫–æ–¥–∞
        const response = await fetch('/projects/verify-qr-code/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            },
            body: JSON.stringify({ code: qrCodeText })
        });
        
        const data = await response.json();
        
        if (data.success) {
            // QR-–∫–æ–¥ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ
            stopQRScanner();
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
            document.getElementById('verification_type').value = 'qr_code';
            document.getElementById('qr_code_id').value = data.qr_code_id;
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã QR-–∫–æ–¥–∞, –∑–∞–ø–æ–ª–Ω—è–µ–º –∏—Ö
            if (data.latitude && data.longitude) {
                document.getElementById('latitude').value = data.latitude;
                document.getElementById('longitude').value = data.longitude;
            }
            
            isVerified = true;
            showVerificationStatus(
                `‚úÖ –ú–µ—Å—Ç–æ–Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —á–µ—Ä–µ–∑ QR-–∫–æ–¥ "${data.qr_code_name}"`,
                'success'
            );
        } else {
            showVerificationStatus(
                '‚ùå –û—à–∏–±–∫–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏: ' + (data.message || '–ù–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–π QR-–∫–æ–¥'),
                'error'
            );
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ QR-–∫–æ–¥–∞:', error);
        showVerificationStatus('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
    }
}

function showVerificationStatus(message, type) {
    const container = document.getElementById('verification-status');
    
    let bgClass, textClass, iconClass;
    if (type === 'success') {
        bgClass = 'bg-green-50 border-green-200';
        textClass = 'text-green-800';
        iconClass = 'text-green-500';
    } else if (type === 'error') {
        bgClass = 'bg-red-50 border-red-200';
        textClass = 'text-red-800';
        iconClass = 'text-red-500';
    } else {
        bgClass = 'bg-blue-50 border-blue-200';
        textClass = 'text-blue-800';
        iconClass = 'text-blue-500';
    }
    
    container.innerHTML = `
        <div class="verification-status border-2 rounded-xl p-4 ${bgClass}">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} ${iconClass} text-lg"></i>
                </div>
                <div class="ml-3">
                    <p class="${textClass} font-medium">${message}</p>
                </div>
            </div>
        </div>
    `;
}

// –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
document.getElementById('get-location').addEventListener('click', function() {
    if (navigator.geolocation) {
        showVerificationStatus('üîç –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è...', 'info');
        
        navigator.geolocation.getCurrentPosition(
            function(position) {
                document.getElementById('latitude').value = position.coords.latitude.toFixed(6);
                document.getElementById('longitude').value = position.coords.longitude.toFixed(6);
                document.getElementById('verification_type').value = 'geolocation';
                
                isVerified = true;
                showVerificationStatus(
                    '‚úÖ –ú–µ—Å—Ç–æ–Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —á–µ—Ä–µ–∑ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é',
                    'success'
                );
            },
            function(error) {
                let message;
                switch (error.code) {
                    case error.PERMISSION_DENIED:
                        message = '–î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–µ—â–µ–Ω. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—é.';
                        break;
                    case error.POSITION_UNAVAILABLE:
                        message = '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.';
                        break;
                    case error.TIMEOUT:
                        message = '–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è.';
                        break;
                    default:
                        message = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è.';
                        break;
                }
                showVerificationStatus('‚ùå ' + message, 'error');
            },
            {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 0
            }
        );
    } else {
        showVerificationStatus('‚ùå –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º', 'error');
    }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
function handleFileSelect(event) {
    const files = Array.from(event.target.files);
    selectedFiles = files;
    updatePhotosPreview();
}

function updatePhotosPreview() {
    const preview = document.getElementById('photos-preview');
    preview.innerHTML = '';
    
    selectedFiles.forEach((file, index) => {
        if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const div = document.createElement('div');
                div.className = 'relative';
                div.innerHTML = `
                    <img src="${e.target.result}" alt="–ü—Ä–µ–≤—å—é ${index + 1}" 
                         class="h-24 w-24 object-cover rounded-lg border">
                    <button type="button" onclick="removePhoto(${index})" 
                            class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs hover:bg-red-600">
                        √ó
                    </button>
                    <p class="text-xs text-gray-600 mt-1 truncate">${file.name}</p>
                `;
                preview.appendChild(div);
            };
            reader.readAsDataURL(file);
        }
    });
}

function removePhoto(index) {
    selectedFiles.splice(index, 1);
    updatePhotosPreview();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º input file
    const input = document.getElementById('photos');
    const dt = new DataTransfer();
    selectedFiles.forEach(file => dt.items.add(file));
    input.files = dt.files;
}

// –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
document.getElementById('violation-form').addEventListener('submit', function(e) {
    e.preventDefault(); // –í—Å–µ–≥–¥–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É
    
    const form = this;
    const classifierSelect = document.getElementById('violation_classifier_id');
    
    if (!classifierSelect.value) {
        showNotification('–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∑–∞–º–µ—á–∞–Ω–∏—è', 'error');
        return false;
    }
    
    // –û–±—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
    if (!document.getElementById('project_id').value) {
        showNotification('–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç', 'error');
        return false;
    }
    
    if (!document.getElementById('title').value.trim()) {
        showNotification('–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è', 'error');
        return false;
    }
    
    if (!document.getElementById('description').value.trim()) {
        showNotification('–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è', 'error');
        return false;
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –Ω–∞ –æ–±—ä–µ–∫—Ç–µ
    if (!isVerified) {
        showNotification('–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏', '–î–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤–∞—à–µ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –Ω–∞ –æ–±—ä–µ–∫—Ç–µ —á–µ—Ä–µ–∑ QR-–∫–æ–¥ –∏–ª–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é.', 'warning');
        return false;
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∞—Å–∏–≤–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
    showConfirm(
        '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ñ–∏–∫—Å–∞—Ü–∏–∏',
        '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ? –ü–æ—Å–ª–µ —Ñ–∏–∫—Å–∞—Ü–∏–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –±—É–¥–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º –ª–∏—Ü–∞–º.',
        function() {
            form.submit();
        }
    );
});

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ textarea
document.getElementById('description').addEventListener('input', function() {
    this.style.height = 'auto';
    this.style.height = this.scrollHeight + 'px';
});
</script>
{% endblock %}