{% extends 'base.html' %}
{% load static %}

{% block title %}–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞–≤–∫–∏ —Å OCR —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ–º - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto space-y-6">
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
  <div class="bg-white shadow-lg rounded-xl border border-gray-100">
    <div class="px-8 py-6 border-b border-gray-200">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-bold text-gray-900">
            <i class="fas fa-robot text-blue-600 mr-3"></i>
            –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞–≤–∫–∏ —Å OCR
          </h1>
          <p class="mt-2 text-lg text-gray-600">
            –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
          </p>
        </div>
        <div class="flex items-center space-x-2">
          <div class="px-4 py-2 bg-green-100 text-green-800 rounded-lg text-sm font-medium">
            <i class="fas fa-shield-check mr-2"></i>
            AI –ü–æ–¥–¥–µ—Ä–∂–∫–∞
          </div>
        </div>
      </div>
    </div>
  </div>
    
    <style>
        .upload-area {
            border: 3px dashed #d1d5db;
            transition: all 0.3s ease;
        }
        
        .upload-area.drag-over {
            border-color: #2942F9;
            background-color: #f0f4ff;
        }
        
        .processing {
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        .ocr-field {
            transition: all 0.3s ease;
        }
        
        .ocr-field.high-confidence {
            border-color: #10b981;
            background-color: #f0fdf4;
        }
        
        .ocr-field.medium-confidence {
            border-color: #f59e0b;
            background-color: #fffbeb;
        }
        
        .ocr-field.low-confidence {
            border-color: #ef4444;
            background-color: #fef2f2;
        }
        
        .image-preview {
            max-height: 400px;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .confidence-indicator {
            position: relative;
            height: 6px;
            background-color: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
        }
        
        .confidence-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        .pulse-success {
            animation: pulse-green 0.6s ease-in-out;
        }
        
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }
        
        .shake-error {
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .processing-glow {
            box-shadow: 0 0 20px rgba(41, 66, 249, 0.3);
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(41, 66, 249, 0.3); }
            to { box-shadow: 0 0 30px rgba(41, 66, 249, 0.6); }
        }
    </style>

  <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
  <div class="bg-gradient-to-r from-primary-blue/10 to-accent-peach/10 border border-primary-blue/20 rounded-lg p-6">
    <div class="flex items-start">
      <div class="flex-shrink-0">
        <div class="w-12 h-12 bg-primary-blue rounded-lg flex items-center justify-center">
          <i class="fas fa-search-plus text-white text-xl"></i>
        </div>
      </div>
      <div class="ml-4">
        <h3 class="text-primary-dark font-medium mb-1">–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –≤—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è</h3>
        <p class="text-gray-700 text-sm">
          –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Ç–æ–≤–∞—Ä–Ω–æ-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–π –Ω–∞–∫–ª–∞–¥–Ω–æ–π (–¢–¢–ù) –∏ –¥—Ä—É–≥–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤. 
          –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–≥–æ –∑—Ä–µ–Ω–∏—è –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç –ø–æ–ª—è.
        </p>
      </div>
    </div>
  </div>

        <!-- –í—ã–±–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø–æ—Å—Ç–∞–≤–∫–∏ -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="fas fa-building text-primary-blue mr-2"></i>
                –í—ã–±–æ—Ä –æ–±—ä–µ–∫—Ç–∞ –∏ –ø–æ—Å—Ç–∞–≤–∫–∏
            </h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- –í—ã–±–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞ -->
                <div>
                    <label for="project-select" class="block text-sm font-medium text-gray-700 mb-2">
                        –û–±—ä–µ–∫—Ç —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞
                    </label>
                    <select id="project-select" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-blue focus:border-transparent">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç...</option>
                    </select>
                </div>
                
                <!-- –í—ã–±–æ—Ä –ø–æ—Å—Ç–∞–≤–∫–∏ -->
                <div>
                    <label for="delivery-select" class="block text-sm font-medium text-gray-700 mb-2">
                        –ü–æ—Å—Ç–∞–≤–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
                    </label>
                    <select id="delivery-select" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-blue focus:border-transparent" disabled>
                        <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç...</option>
                    </select>
                </div>
            </div>
            
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ø–æ—Å—Ç–∞–≤–∫–µ -->
            <div id="delivery-info" class="mt-4 p-4 bg-gray-50 rounded-lg hidden">
                <h3 class="font-medium text-gray-900 mb-2">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—Å—Ç–∞–≤–∫–µ:</h3>
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 text-sm">
                    <div>
                        <span class="text-gray-600">–ú–∞—Ç–µ—Ä–∏–∞–ª:</span>
                        <div id="delivery-material" class="font-medium"></div>
                    </div>
                    <div>
                        <span class="text-gray-600">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</span>
                        <div id="delivery-quantity" class="font-medium"></div>
                    </div>
                    <div>
                        <span class="text-gray-600">–ü–æ—Å—Ç–∞–≤—â–∏–∫:</span>
                        <div id="delivery-supplier" class="font-medium"></div>
                    </div>
                    <div>
                        <span class="text-gray-600">–î–∞—Ç–∞ –ø–æ—Å—Ç–∞–≤–∫–∏:</span>
                        <div id="delivery-date" class="font-medium"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ -->
        <div id="upload-section" class="bg-white rounded-lg shadow p-6 mb-6 hidden">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="fas fa-camera text-primary-blue mr-2"></i>
                –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
            </h2>
            
            <!-- –í—ã–±–æ—Ä —Ç–∏–ø–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ -->
            <div class="mb-4">
                <label for="document-type" class="block text-sm font-medium text-gray-700 mb-2">
                    –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞
                </label>
                <select id="document-type" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-blue">
                    <option value="ttn_main">–û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¢–¢–ù</option>
                    <option value="ttn_additional">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¢–¢–ù</option>
                    <option value="quality_certificate">–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∫–∞—á–µ—Å—Ç–≤–∞</option>
                    <option value="passport_material">–ü–∞—Å–ø–æ—Ä—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–∞</option>
                    <option value="invoice">–°—á–µ—Ç-—Ñ–∞–∫—Ç—É—Ä–∞</option>
                    <option value="other">–î—Ä—É–≥–æ–π –¥–æ–∫—É–º–µ–Ω—Ç</option>
                </select>
            </div>
            
            <!-- –û–±–ª–∞—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ -->
            <div id="upload-area" class="upload-area border-2 rounded-lg p-8 text-center cursor-pointer">
                <div class="space-y-4">
                    <div>
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                    </div>
                    <div>
                        <p class="text-lg text-gray-700">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Å—é–¥–∞</p>
                        <p class="text-sm text-gray-500">–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞</p>
                    </div>
                    <div>
                        <span class="text-xs text-gray-400">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç—ã: JPG, PNG, PDF (–¥–æ 10–ú–ë)</span>
                    </div>
                </div>
                <input type="file" id="file-input" class="hidden" accept="image/*,.pdf">
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
        <div id="processing-section" class="bg-white rounded-lg shadow p-6 hidden">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="fas fa-cog text-primary-blue mr-2"></i>
                –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
            </h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- –ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
                <div>
                    <h3 class="font-medium text-gray-900 mb-3">–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç</h3>
                    <div class="border border-gray-200 rounded-lg p-4">
                        <img id="image-preview" class="image-preview w-full object-contain" alt="–ü—Ä–µ–≤—å—é –¥–æ–∫—É–º–µ–Ω—Ç–∞">
                    </div>
                </div>
                
                <!-- –°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ -->
                <div>
                    <h3 class="font-medium text-gray-900 mb-3">
                        <i class="fas fa-cog text-primary-blue mr-2"></i>
                        –°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è OCR
                    </h3>
                    
                    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ -->
                    <div id="processing-indicator" class="mb-4">
                        <div class="flex items-center space-x-3">
                            <div id="processing-spinner" class="processing hidden">
                                <i class="fas fa-spinner fa-spin text-primary-blue text-lg"></i>
                            </div>
                            <div id="processing-status" class="text-sm text-gray-600 font-medium">üìÑ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞...</div>
                        </div>
                        
                        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ -->
                        <div id="processing-progress" class="mt-3 hidden">
                            <div class="flex justify-between text-xs text-gray-600 mb-1">
                                <span>–ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏</span>
                                <span id="processing-percent">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div id="processing-bar" class="bg-primary-blue h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ OCR -->
                        <div id="confidence-indicator" class="mt-3 hidden">
                            <div class="flex justify-between text-xs text-gray-600 mb-1">
                                <span>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è</span>
                                <span id="confidence-percent">0%</span>
                            </div>
                            <div class="confidence-indicator">
                                <div id="confidence-fill" class="confidence-fill bg-green-500" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                    <div class="space-y-2">
                        <button id="process-btn" class="w-full bg-primary-blue text-white px-4 py-2 rounded-md hover:bg-primary-dark transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed" disabled>
                            <i class="fas fa-robot mr-2"></i>
                            –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ OCR
                        </button>
                        
                        <button id="reprocess-btn" class="w-full bg-secondary-blue text-white px-4 py-2 rounded-md hover:bg-gray-700 transition-colors hidden">
                            <i class="fas fa-redo mr-2"></i>
                            –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
                        </button>
                        
                        <button id="auto-process-toggle" class="w-full bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors text-sm hidden">
                            <i class="fas fa-magic mr-2"></i>
                            –ê–≤—Ç–æ—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ: –í–ö–õ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö -->
        <div id="extracted-data-section" class="bg-white rounded-lg shadow p-6 hidden">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold text-gray-900">
                    <i class="fas fa-clipboard-list text-primary-blue mr-2"></i>
                    –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                </h2>
                
                <div class="flex space-x-2">
                    <button id="validate-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors transform hover:scale-105 font-medium shadow-lg" onclick="validateData()">
                        <i class="fas fa-check mr-2"></i>
                        –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                    
                    <button id="save-btn" class="bg-green-600 text-white px-6 py-3 rounded-md hover:bg-green-700 transition-colors transform hover:scale-105 font-medium shadow-lg" onclick="saveData()">
                        <i class="fas fa-save mr-2"></i>
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                    </button>
                </div>
            </div>
            
            <!-- –§–æ—Ä–º–∞ —Å –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ -->
            <form id="extracted-data-form" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ–∫—É–º–µ–Ω—Ç–µ -->
                    <div class="space-y-4">
                        <h3 class="font-medium text-gray-900 border-b pb-2">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ–∫—É–º–µ–Ω—Ç–µ</h3>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                –ù–æ–º–µ—Ä –¢–¢–ù
                                <span class="confidence-badge ml-1"></span>
                            </label>
                            <input type="text" name="document_number" class="ocr-field w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-blue" readonly>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                –î–∞—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
                                <span class="confidence-badge ml-1"></span>
                            </label>
                            <input type="date" name="document_date" class="ocr-field w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-blue" readonly>
                        </div>
                    </div>
                    
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ –∏ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ -->
                    <div class="space-y-4">
                        <h3 class="font-medium text-gray-900 border-b pb-2">–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—å</h3>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å
                                <span class="confidence-badge ml-1"></span>
                            </label>
                            <input type="text" name="sender_name" class="ocr-field w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-blue" readonly>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                –ü–æ–ª—É—á–∞—Ç–µ–ª—å
                                <span class="confidence-badge ml-1"></span>
                            </label>
                            <input type="text" name="receiver_name" class="ocr-field w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-blue" readonly>
                        </div>
                    </div>
                    
                    <!-- –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                    <div class="space-y-4">
                        <h3 class="font-medium text-gray-900 border-b pb-2">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                –ù–æ–º–µ—Ä –¢–°
                                <span class="confidence-badge ml-1"></span>
                            </label>
                            <input type="text" name="vehicle_number" class="ocr-field w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-blue" readonly>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                –§–ò–û –≤–æ–¥–∏—Ç–µ–ª—è
                                <span class="confidence-badge ml-1"></span>
                            </label>
                            <input type="text" name="driver_name" class="ocr-field w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-blue" readonly>
                        </div>
                    </div>
                    
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥—Ä—É–∑–µ -->
                    <div class="space-y-4">
                        <h3 class="font-medium text-gray-900 border-b pb-2">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥—Ä—É–∑–µ</h3>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                –û–ø–∏—Å–∞–Ω–∏–µ –≥—Ä—É–∑–∞
                                <span class="confidence-badge ml-1"></span>
                            </label>
                            <textarea name="cargo_description" rows="2" class="ocr-field w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-blue" readonly></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                –í–µ—Å –≥—Ä—É–∑–∞ (–∫–≥)
                                <span class="confidence-badge ml-1"></span>
                            </label>
                            <input type="number" step="0.01" name="cargo_weight" class="ocr-field w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-blue" readonly>
                        </div>
                    </div>
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
                <div class="flex justify-between items-center pt-4 border-t">
                    <button type="button" id="edit-btn" class="bg-yellow-600 text-white px-6 py-3 rounded-md hover:bg-yellow-700 transition-colors transform hover:scale-105 font-medium shadow-lg" onclick="toggleEditMode()">
                        <i class="fas fa-edit mr-2"></i>
                        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
                    </button>
                    
                    <div class="text-sm text-gray-500">
                        <span id="manual-check-indicator" class="hidden">
                            <i class="fas fa-exclamation-triangle text-yellow-500 mr-1"></i>
                            –¢—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
                        </span>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ -->
        <div id="validation-section" class="bg-white rounded-lg shadow p-6 hidden">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="fas fa-shield-alt text-primary-blue mr-2"></i>
                –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏
            </h2>
            
            <div id="validation-results" class="space-y-3">
                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>

    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="notifications" class="fixed top-4 right-4 space-y-2 z-50">
        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
    </div>

    <!-- JavaScript -->
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentDeliveryId = null;
        let currentPhotoId = null;
        let currentOCRResultId = null;
        let isEditMode = false;
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ CSRF —Ç–æ–∫–µ–Ω–∞
        const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            loadProjects();
            setupEventListeners();
        });
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –í—ã–±–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞
            document.getElementById('project-select').addEventListener('change', function() {
                const projectId = this.value;
                if (projectId) {
                    loadProjectDeliveries(projectId);
                } else {
                    resetDeliverySelect();
                }
            });
            
            // –í—ã–±–æ—Ä –ø–æ—Å—Ç–∞–≤–∫–∏
            document.getElementById('delivery-select').addEventListener('change', function() {
                const deliveryId = this.value;
                if (deliveryId) {
                    selectDelivery(deliveryId);
                } else {
                    hideUploadSection();
                }
            });
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
            const uploadArea = document.getElementById('upload-area');
            const fileInput = document.getElementById('file-input');
            
            uploadArea.addEventListener('click', () => fileInput.click());
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('drop', handleDrop);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            fileInput.addEventListener('change', handleFileSelect);
            
            // –ö–Ω–æ–ø–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
            document.getElementById('process-btn').addEventListener('click', processDocument);
            document.getElementById('reprocess-btn').addEventListener('click', reprocessDocument);
            document.getElementById('validate-btn').addEventListener('click', validateData);
            document.getElementById('save-btn').addEventListener('click', saveData);
            document.getElementById('edit-btn').addEventListener('click', toggleEditMode);
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤
        async function loadProjects() {
            try {
                // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å API –≤—ã–∑–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤
                // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º—ã
                const projects = [
                    { id: 7, name: "–ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Å–∫–≤–µ—Ä–∞ –Ω–∞ —É–ª. –¢–≤–µ—Ä—Å–∫–∞—è" },
                    { id: 6, name: "–†–µ–º–æ–Ω—Ç –¥–æ—Ä–æ–≥–∏ –Ω–∞ –ø—Ä. –ú–∏—Ä–∞" },
                    { id: 5, name: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–µ—Ç—Å–∫–æ–π –ø–ª–æ—â–∞–¥–∫–∏ –≤ –ø–∞—Ä–∫–µ –°–æ–∫–æ–ª—å–Ω–∏–∫–∏" }
                ];
                
                const projectSelect = document.getElementById('project-select');
                projectSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç...</option>';
                
                projects.forEach(project => {
                    const option = document.createElement('option');
                    option.value = project.id;
                    option.textContent = project.name;
                    projectSelect.appendChild(option);
                });
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤', 'error');
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–∞–≤–æ–∫ –ø—Ä–æ–µ–∫—Ç–∞
        async function loadProjectDeliveries(projectId) {
            try {
                const response = await fetch(`/api/materials/projects/${projectId}/deliveries-ocr/`);
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error);
                }
                
                const deliverySelect = document.getElementById('delivery-select');
                deliverySelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Å—Ç–∞–≤–∫—É...</option>';
                deliverySelect.disabled = false;
                
                data.data.deliveries.forEach(delivery => {
                    const option = document.createElement('option');
                    option.value = delivery.id;
                    option.textContent = `${delivery.material_type.name} - ${delivery.quantity} ${delivery.material_type.unit} (${delivery.supplier})`;
                    deliverySelect.appendChild(option);
                });
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–∞–≤–æ–∫:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–∞–≤–æ–∫ –ø—Ä–æ–µ–∫—Ç–∞', 'error');
                resetDeliverySelect();
            }
        }
        
        // –í—ã–±–æ—Ä –ø–æ—Å—Ç–∞–≤–∫–∏
        async function selectDelivery(deliveryId) {
            currentDeliveryId = deliveryId;
            
            try {
                const response = await fetch(`/api/materials/deliveries/${deliveryId}/ttn-documents/`);
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error);
                }
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Å—Ç–∞–≤–∫–µ
                showDeliveryInfo(data.data.delivery);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –∑–∞–≥—Ä—É–∑–∫–∏
                showUploadSection();
                
                // –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö
                if (data.data.documents.length > 0) {
                    // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ—Å—Ç–∞–≤–∫–µ:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ—Å—Ç–∞–≤–∫–µ', 'error');
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }
        
        function handleDragLeave(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            const uploadArea = e.currentTarget;
            uploadArea.classList.remove('drag-over');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }
        
        function handleFileSelect(e) {
            const files = e.target.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
        function handleFile(file) {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
            const allowedTypes = ['image/jpeg', 'image/png', 'image/jpg', 'application/pdf'];
            if (!allowedTypes.includes(file.type)) {
                showNotification('–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ JPG, PNG –∏–ª–∏ PDF', 'error');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (10MB)
            if (file.size > 10 * 1024 * 1024) {
                showNotification('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10–ú–ë', 'error');
                return;
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø—Ä–µ–≤—å—é
            showImagePreview(file);
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª
            uploadDocument(file);
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function showImagePreview(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const imagePreview = document.getElementById('image-preview');
                imagePreview.src = e.target.result;
                showProcessingSection();
            };
            reader.readAsDataURL(file);
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        async function uploadDocument(file) {
            const formData = new FormData();
            formData.append('image', file);
            formData.append('delivery_id', currentDeliveryId);
            formData.append('photo_type', document.getElementById('document-type').value);
            
            try {
                updateProcessingStatus('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞...', true);
                
                const response = await fetch('/api/materials/ttn/upload/', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': csrfToken,
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error);
                }
                
                currentPhotoId = data.data.document_photo_id;
                updateProcessingStatus('–î–æ–∫—É–º–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–µ–Ω. –ì–æ—Ç–æ–≤ –∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—é.', false);
                
                // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏
                enableProcessButton();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π OCR —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                if (data.data.ocr_result && data.data.ocr_result.success) {
                    currentOCRResultId = data.data.ocr_result.ocr_result_id;
                    showExtractedData(data.data.ocr_result);
                    updateProcessingStatus('‚ú® –î–æ–∫—É–º–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω. <strong>–ö–ª–∏–∫–Ω–∏—Ç–µ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ"</strong> –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è.', false);
                } else if (data.data.ocr_result && !data.data.ocr_result.success) {
                    updateProcessingStatus('‚ö†Ô∏è –ê–≤—Ç–æ—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ OCR.', false);
                    enableReprocessButton();
                } else {
                    updateProcessingStatus('üöÄ –î–æ–∫—É–º–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–µ–Ω. –ù–∞–∂–º–∏—Ç–µ <strong>"–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ OCR"</strong>.', false);
                }
                
                showNotification(data.message, 'success');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞: ' + error.message, 'error');
                updateProcessingStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏', false);
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
        async function processDocument() {
            if (!currentPhotoId) {
                showNotification('–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç', 'error');
                return;
            }
            
            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
            const processBtn = document.getElementById('process-btn');
            processBtn.disabled = true;
            processBtn.classList.add('opacity-50', 'cursor-not-allowed');
            
            try {
                updateProcessingStatus('ü§ñ –ó–∞–ø—É—Å–∫ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞...', true);
                addProcessingGlow();
                
                const response = await fetch(`/api/materials/ttn/photos/${currentPhotoId}/process/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': csrfToken,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error);
                }
                
                if (data.data.success) {
                    // –ó–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
                    completeProgress();
                    currentOCRResultId = data.data.ocr_result_id;
                    showExtractedData(data.data);
                    updateProcessingStatus('‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! <strong>–ö–ª–∏–∫–Ω–∏—Ç–µ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ"</strong> –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è.', false);
                    showNotification('üéâ –î–æ–∫—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω! –ö–ª–∏–∫–Ω–∏—Ç–µ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.', 'success');
                    // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
                    addSuccessAnimation();
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
                    enableReprocessButton();
                    
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                    highlightEditButton();
                } else {
                    updateProcessingStatus('‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è: ' + data.data.error, false);
                    showNotification('‚ö†Ô∏è –û—à–∏–±–∫–∞ OCR: ' + data.data.error, 'error');
                    addErrorAnimation();
                    enableReprocessButton();
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ OCR –æ–±—Ä–∞–±–æ—Ç–∫–∏: ' + error.message, 'error');
                updateProcessingStatus('‚ùå –°–±–æ–π –≤ —Å–∏—Å—Ç–µ–º–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è', false);
            } finally {
                // –£–±–∏—Ä–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç —Å–≤–µ—á–µ–Ω–∏—è
                removeProcessingGlow();
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                processBtn.disabled = false;
                processBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }
        
        // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
        async function reprocessDocument() {
            await processDocument();
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function showExtractedData(ocrData) {
            const section = document.getElementById('extracted-data-section');
            const form = document.getElementById('extracted-data-form');
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
            const fields = ocrData.extracted_fields || {};
            const confidences = ocrData.field_confidences || {};
            
            Object.keys(fields).forEach(fieldName => {
                const input = form.querySelector(`[name="${fieldName}"]`);
                if (input) {
                    input.value = fields[fieldName];
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–ª–∞—Å—Å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
                    const confidence = confidences[fieldName] || 0;
                    setConfidenceClass(input, confidence);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
                    updateConfidenceBadge(input, confidence);
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
            updateConfidenceIndicator(ocrData.confidence || 0);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
            if (ocrData.requires_manual_check) {
                document.getElementById('manual-check-indicator').classList.remove('hidden');
            }
            
            section.classList.remove('hidden');
        }
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        async function validateData() {
            if (!currentOCRResultId) {
                showNotification('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏', 'error');
                return;
            }
            
            try {
                const response = await fetch(`/api/materials/ttn/ocr-results/${currentOCRResultId}/validate/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': csrfToken,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error);
                }
                
                showValidationResults(data.data);
                showNotification('–í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 'success');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:', error);
                showNotification('–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏: ' + error.message, 'error');
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        async function saveData() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–µ–Ω
            if (!isEditMode) {
                showNotification('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!', 'warning');
                highlightEditButton();
                return;
            }
            
            if (!currentOCRResultId) {
                showNotification('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
                return;
            }
            
            // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º—ã
            const form = document.getElementById('extracted-data-form');
            const formData = new FormData(form);
            const extractedFields = {};
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
            const requiredFields = form.querySelectorAll('input[required], textarea[required]');
            let hasErrors = false;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('ring-2', 'ring-red-300', 'bg-red-50');
                    hasErrors = true;
                } else {
                    field.classList.remove('ring-2', 'ring-red-300', 'bg-red-50');
                }
            });
            
            if (hasErrors) {
                showNotification('‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!', 'error');
                return;
            }
            
            for (let [key, value] of formData.entries()) {
                extractedFields[key] = value;
            }
            
            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ –≤—Ä–µ–º—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            const saveBtn = document.getElementById('save-btn');
            const originalText = saveBtn.innerHTML;
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
            saveBtn.className = 'bg-gray-400 text-white px-6 py-3 rounded-md cursor-not-allowed';
            
            showNotification('üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...', 'info');
            
            try {
                const response = await fetch(`/api/materials/ttn/ocr-results/${currentOCRResultId}/update/`, {
                    method: 'PUT',
                    headers: {
                        'X-CSRFToken': csrfToken,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        extracted_fields: extractedFields
                    })
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error);
                }
                
                showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
                
                // –ü–µ—Ä–µ–≤–æ–¥–∏–º –ø–æ–ª—è –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ä–µ–∂–∏–º —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è
                setTimeout(() => {
                    if (isEditMode) {
                        toggleEditMode();
                    }
                }, 1500);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message, 'error');
            } finally {
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –≤–∏–¥
                saveBtn.disabled = false;
                saveBtn.innerHTML = originalText;
                saveBtn.className = 'bg-green-600 text-white px-6 py-3 rounded-md hover:bg-green-700 transition-colors transform hover:scale-105 font-medium shadow-lg';
            }
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function toggleEditMode() {
            isEditMode = !isEditMode;
            const form = document.getElementById('extracted-data-form');
            const inputs = form.querySelectorAll('input, textarea');
            const editBtn = document.getElementById('edit-btn');
            
            // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –ø—Ä–∏ –∫–ª–∏–∫–µ
            editBtn.classList.remove('ring-4', 'ring-yellow-300', 'animate-pulse');
            
            inputs.forEach(input => {
                input.readOnly = !isEditMode;
                
                if (isEditMode) {
                    // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –ø–æ–ª–µ–π –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                    input.classList.add('ring-2', 'ring-blue-300', 'bg-blue-50');
                    input.style.cursor = 'text';
                } else {
                    input.classList.remove('ring-2', 'ring-blue-300', 'bg-blue-50');
                    input.style.cursor = 'default';
                }
            });
            
            if (isEditMode) {
                editBtn.innerHTML = '<i class="fas fa-times mr-2"></i>–û—Ç–º–µ–Ω–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ';
                editBtn.className = 'bg-gray-600 text-white px-6 py-3 rounded-md hover:bg-gray-700 transition-colors transform hover:scale-105 font-medium shadow-lg';
                showNotification('‚úèÔ∏è –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω. –ò–∑–º–µ–Ω—è–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å".', 'info');
            } else {
                editBtn.innerHTML = '<i class="fas fa-edit mr-2"></i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ';
                editBtn.className = 'bg-yellow-600 text-white px-6 py-3 rounded-md hover:bg-yellow-700 transition-colors transform hover:scale-105 font-medium shadow-lg';
                showNotification('‚úÖ –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω.', 'success');
            }
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function showDeliveryInfo(delivery) {
            document.getElementById('delivery-material').textContent = delivery.material_type;
            document.getElementById('delivery-quantity').textContent = `${delivery.quantity} –µ–¥.`;
            document.getElementById('delivery-supplier').textContent = delivery.supplier;
            document.getElementById('delivery-date').textContent = new Date(delivery.delivery_date).toLocaleDateString();
            document.getElementById('delivery-info').classList.remove('hidden');
        }
        
        function showUploadSection() {
            document.getElementById('upload-section').classList.remove('hidden');
        }
        
        function hideUploadSection() {
            document.getElementById('upload-section').classList.add('hidden');
            document.getElementById('processing-section').classList.add('hidden');
            document.getElementById('extracted-data-section').classList.add('hidden');
            document.getElementById('validation-section').classList.add('hidden');
        }
        
        function showProcessingSection() {
            document.getElementById('processing-section').classList.remove('hidden');
        }
        
        function enableProcessButton() {
            const processBtn = document.getElementById('process-btn');
            processBtn.disabled = false;
            processBtn.classList.remove('bg-gray-300');
            processBtn.classList.add('bg-primary-blue', 'hover:bg-primary-dark');
        }
        
        function updateProcessingStatus(status, isProcessing) {
            document.getElementById('processing-status').innerHTML = status;
            const spinner = document.getElementById('processing-spinner');
            const progressSection = document.getElementById('processing-progress');
            
            if (isProcessing) {
                spinner.classList.remove('hidden');
                progressSection.classList.remove('hidden');
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                animateProgress();
            } else {
                spinner.classList.add('hidden');
                progressSection.classList.add('hidden');
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
                resetProgress();
            }
        }
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
        function animateProgress() {
            const bar = document.getElementById('processing-bar');
            const percent = document.getElementById('processing-percent');
            let currentProgress = 0;
            
            const interval = setInterval(() => {
                currentProgress += Math.random() * 15; // –°–ª—É—á–∞–π–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç
                
                if (currentProgress >= 90) {
                    currentProgress = 90; // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—Å—è –Ω–∞ 90% –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
                    clearInterval(interval);
                }
                
                bar.style.width = currentProgress + '%';
                percent.textContent = Math.round(currentProgress) + '%';
            }, 300);
        }
        
        function resetProgress() {
            document.getElementById('processing-bar').style.width = '0%';
            document.getElementById('processing-percent').textContent = '0%';
        }
        
        function completeProgress() {
            const bar = document.getElementById('processing-bar');
            const percent = document.getElementById('processing-percent');
            bar.style.width = '100%';
            percent.textContent = '100%';
            
            // –ß–µ—Ä–µ–∑ –Ω–µ–º–Ω–æ–≥–æ —Å–∫—Ä—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
            setTimeout(() => {
                document.getElementById('processing-progress').classList.add('hidden');
            }, 1000);
        }
        
        // –í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
        function addSuccessAnimation() {
            const section = document.getElementById('processing-section');
            section.classList.add('pulse-success');
            
            setTimeout(() => {
                section.classList.remove('pulse-success');
            }, 600);
        }
        
        function addErrorAnimation() {
            const section = document.getElementById('processing-section');
            section.classList.add('shake-error');
            
            setTimeout(() => {
                section.classList.remove('shake-error');
            }, 500);
        }
        
        function addProcessingGlow() {
            const section = document.getElementById('processing-section');
            section.classList.add('processing-glow');
        }
        
        function removeProcessingGlow() {
            const section = document.getElementById('processing-section');
            section.classList.remove('processing-glow');
        }
        
        function enableReprocessButton() {
            document.getElementById('reprocess-btn').classList.remove('hidden');
        }
        
        function updateConfidenceIndicator(confidence) {
            const indicator = document.getElementById('confidence-indicator');
            const fill = document.getElementById('confidence-fill');
            const percent = document.getElementById('confidence-percent');
            
            fill.style.width = confidence + '%';
            percent.textContent = Math.round(confidence) + '%';
            
            // –¶–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
            if (confidence >= 80) {
                fill.className = 'confidence-fill bg-green-500';
            } else if (confidence >= 60) {
                fill.className = 'confidence-fill bg-yellow-500';
            } else {
                fill.className = 'confidence-fill bg-red-500';
            }
            
            indicator.classList.remove('hidden');
        }
        
        function setConfidenceClass(input, confidence) {
            input.classList.remove('high-confidence', 'medium-confidence', 'low-confidence');
            
            if (confidence >= 80) {
                input.classList.add('high-confidence');
            } else if (confidence >= 60) {
                input.classList.add('medium-confidence');
            } else {
                input.classList.add('low-confidence');
            }
        }
        
        function updateConfidenceBadge(input, confidence) {
            const label = input.closest('div').querySelector('label');
            const badge = label.querySelector('.confidence-badge');
            
            if (confidence > 0) {
                badge.innerHTML = `<span class="text-xs px-2 py-1 rounded-full ${
                    confidence >= 80 ? 'bg-green-100 text-green-800' :
                    confidence >= 60 ? 'bg-yellow-100 text-yellow-800' :
                    'bg-red-100 text-red-800'
                }">${Math.round(confidence)}%</span>`;
            }
        }
        
        function showValidationResults(validationData) {
            const section = document.getElementById('validation-section');
            const results = document.getElementById('validation-results');
            
            results.innerHTML = '';
            
            // –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å
            const statusDiv = document.createElement('div');
            statusDiv.className = `p-4 rounded-lg ${
                validationData.validation_status === 'valid' ? 'bg-green-50 border-green-200' :
                validationData.validation_status === 'partial' ? 'bg-yellow-50 border-yellow-200' :
                'bg-red-50 border-red-200'
            } border`;
            
            statusDiv.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${
                        validationData.validation_status === 'valid' ? 'fa-check-circle text-green-500' :
                        validationData.validation_status === 'partial' ? 'fa-exclamation-circle text-yellow-500' :
                        'fa-times-circle text-red-500'
                    } mr-2"></i>
                    <span class="font-medium">
                        ${validationData.validation_status === 'valid' ? '–í—Å–µ –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã' :
                          validationData.validation_status === 'partial' ? '–î–∞–Ω–Ω—ã–µ —á–∞—Å—Ç–∏—á–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã' :
                          '–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ –¥–∞–Ω–Ω—ã—Ö'}
                    </span>
                </div>
            `;
            
            results.appendChild(statusDiv);
            
            // –°–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫
            if (validationData.errors && validationData.errors.length > 0) {
                const errorsDiv = document.createElement('div');
                errorsDiv.className = 'bg-red-50 border border-red-200 rounded-lg p-4';
                errorsDiv.innerHTML = `
                    <h4 class="font-medium text-red-900 mb-2">–ù–∞–π–¥–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏:</h4>
                    <ul class="list-disc list-inside space-y-1 text-red-700">
                        ${validationData.errors.map(error => `<li>${error}</li>`).join('')}
                    </ul>
                `;
                results.appendChild(errorsDiv);
            }
            
            section.classList.remove('hidden');
        }
        
        function resetDeliverySelect() {
            const deliverySelect = document.getElementById('delivery-select');
            deliverySelect.innerHTML = '<option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç...</option>';
            deliverySelect.disabled = true;
            document.getElementById('delivery-info').classList.add('hidden');
            hideUploadSection();
        }
        
        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function highlightEditButton() {
            const editBtn = document.getElementById('edit-btn');
            if (editBtn) {
                // –î–æ–±–∞–≤–ª—è–µ–º —è—Ä–∫—É—é –ø–æ–¥—Å–≤–µ—Ç–∫—É
                editBtn.classList.add('ring-4', 'ring-yellow-300', 'animate-pulse');
                editBtn.innerHTML = '<i class="fas fa-edit mr-2"></i>–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!';
                
                // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
                setTimeout(() => {
                    editBtn.classList.remove('ring-4', 'ring-yellow-300', 'animate-pulse');
                    if (!isEditMode) {
                        editBtn.innerHTML = '<i class="fas fa-edit mr-2"></i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ';
                    }
                }, 5000);
            }
        }
        
        function showNotification(message, type = 'info') {
            const notifications = document.getElementById('notifications');
            const notification = document.createElement('div');
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            const styles = {
                success: { border: 'border-green-500', bg: 'bg-green-50', icon: 'fa-check-circle text-green-500' },
                error: { border: 'border-red-500', bg: 'bg-red-50', icon: 'fa-times-circle text-red-500' },
                warning: { border: 'border-yellow-500', bg: 'bg-yellow-50', icon: 'fa-exclamation-triangle text-yellow-500' },
                info: { border: 'border-blue-500', bg: 'bg-blue-50', icon: 'fa-info-circle text-blue-500' }
            };
            
            const style = styles[type] || styles.info;
            
            notification.className = `max-w-sm mx-auto ${style.bg} border-l-4 ${style.border} p-4 shadow-lg rounded-r-md mb-2 transform transition-all duration-300 ease-in-out`;
            
            notification.innerHTML = `
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <i class="fas ${style.icon} text-lg"></i>
                    </div>
                    <div class="ml-3 flex-1">
                        <p class="text-sm font-medium text-gray-800">${message}</p>
                    </div>
                    <div class="ml-2">
                        <button onclick="this.parentElement.parentElement.parentElement.style.transform='translateX(100%)'; setTimeout(() => this.parentElement.parentElement.parentElement.remove(), 300)" class="text-gray-400 hover:text-gray-600 transition-colors">
                            <i class="fas fa-times text-sm"></i>
                        </button>
                    </div>
                </div>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ—è–≤–ª–µ–Ω–∏—è
            notification.style.transform = 'translateX(100%)';
            notification.style.opacity = '0';
            
            notifications.appendChild(notification);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
                notification.style.opacity = '1';
            }, 10);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
            const autoRemoveTime = type === 'error' ? 8000 : type === 'warning' ? 6000 : 5000;
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.style.transform = 'translateX(100%)';
                    notification.style.opacity = '0';
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, autoRemoveTime);
        }
        
    </script>
    
    <!-- –ù–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
    <div id="notifications" class="fixed top-4 right-4 space-y-2 z-50"></div>
</div>

<meta name="csrf-token" content="{{ csrf_token }}">
{% endblock %}
